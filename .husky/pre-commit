# Run fast, local formatting and linting on changed files
pnpm exec lint-staged
pnpm quality-check --staged --fix

# If workflow files are staged and actionlint exists, run it for fast feedback
if git diff --name-only --cached | grep -E '^\.github/workflows/.*\.(yml|yaml)$' >/dev/null 2>&1; then
	if command -v actionlint >/dev/null 2>&1; then
		echo "Running actionlint on staged workflow files..."
		STAGED_FILES=$(git diff --name-only --cached | grep -E '^\.github/workflows/.*\.(yml|yaml)$' || true)
		if [ -n "$STAGED_FILES" ]; then
			# shellcheck disable=SC2086
			actionlint -no-color -oneline $STAGED_FILES || exit 1
		fi
	else
		echo "actionlint not installed; skipping (install with: brew install actionlint)"
	fi
fi
