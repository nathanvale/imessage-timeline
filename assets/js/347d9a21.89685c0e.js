"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[3786],{5705:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>l});var t=s(7701);const i={},r=t.createContext(i);function c(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),t.createElement(r.Provider,{value:n},e.children)}},8689:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"test-configuration-research","title":"Test Configuration Best Practices Research","description":"Executive Summary","source":"@site/docs/test-configuration-research.md","sourceDirName":".","slug":"/test-configuration-research","permalink":"/imessage-timeline/docs/test-configuration-research","draft":false,"unlisted":false,"editUrl":"https://github.com/nathanvale/imessage-timeline/tree/main/website/docs/test-configuration-research.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"security-supply-chain","permalink":"/imessage-timeline/docs/security-supply-chain"},"next":{"title":"Testing best practices (Vitest + Testing Library + Wallaby)","permalink":"/imessage-timeline/docs/testing-best-practices"}}');var i=s(6801),r=s(5705);const c={},l="Test Configuration Best Practices Research",o={},d=[{value:"Executive Summary",id:"executive-summary",level:2},{value:"Key Findings",id:"key-findings",level:2},{value:"1. TypeScript Community Standards (Official Docs)",id:"1-typescript-community-standards-official-docs",level:3},{value:"Separation of Concerns",id:"separation-of-concerns",level:4},{value:"Why Separate Configs Matter",id:"why-separate-configs-matter",level:4},{value:"Strictness Inheritance Pattern",id:"strictness-inheritance-pattern",level:4},{value:"2. ESLint Community Patterns",id:"2-eslint-community-patterns",level:3},{value:"Official Pattern: File-Specific Overrides (antfu/eslint-config, Trust Score 10)",id:"official-pattern-file-specific-overrides-antfueslint-config-trust-score-10",level:4},{value:"Why This Works",id:"why-this-works",level:4},{value:"Benefits Over Exclusion",id:"benefits-over-exclusion",level:4},{value:"3. Vitest Best Practices (eslint-plugin-vitest, Trust Score 8.3)",id:"3-vitest-best-practices-eslint-plugin-vitest-trust-score-83",level:3},{value:"Configuration Pattern for Test Overrides",id:"configuration-pattern-for-test-overrides",level:4},{value:"Test File Patterns",id:"test-file-patterns",level:4},{value:"Application to imessage-timeline",id:"application-to-imessage-timeline",level:2},{value:"Current Issue",id:"current-issue",level:3},{value:"Root Cause",id:"root-cause",level:3},{value:"Recommended Solution",id:"recommended-solution",level:3},{value:"Option A: Exclude Tests from Lint Typecheck (RECOMMENDED)",id:"option-a-exclude-tests-from-lint-typecheck-recommended",level:4},{value:"Option B: Relax Strictness Selectively (if including tests)",id:"option-b-relax-strictness-selectively-if-including-tests",level:4},{value:"Comparison Table",id:"comparison-table",level:2},{value:"Implementation Plan",id:"implementation-plan",level:2},{value:"Phase 1: Update tsconfig.eslint.json (EXCLUDE TESTS)",id:"phase-1-update-tsconfigeslintjson-exclude-tests",level:3},{value:"Conclusion",id:"conclusion",level:2},{value:"References",id:"references",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"test-configuration-best-practices-research",children:"Test Configuration Best Practices Research"})}),"\n",(0,i.jsx)(n.h2,{id:"executive-summary",children:"Executive Summary"}),"\n",(0,i.jsx)(n.p,{children:"Based on research from TypeScript, ESLint, and Vitest communities, the\nrecommended approach is:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u2705 EXCLUDE test files from strict typecheck \u2192 Use separate tsconfig for test\nvalidation \u2192 Relax strictness selectively for test patterns"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"key-findings",children:"Key Findings"}),"\n",(0,i.jsx)(n.h3,{id:"1-typescript-community-standards-official-docs",children:"1. TypeScript Community Standards (Official Docs)"}),"\n",(0,i.jsx)(n.h4,{id:"separation-of-concerns",children:"Separation of Concerns"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["TypeScript's official handbook recommends ",(0,i.jsx)(n.strong,{children:"separate tsconfig files"})," for\ndifferent parts of a project"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Example pattern:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'// src/tsconfig.json - for production code\n{\n  "compilerOptions": { "outDir": "../dist" },\n  "exclude": ["**/*.test.ts"]\n}\n\n// src/tsconfig.test.json - for tests only\n{\n  "compilerOptions": { "outDir": "../dist/test" },\n  "include": ["**/*.test.ts"],\n  "references": [{ "path": "./tsconfig.json" }]\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"why-separate-configs-matter",children:"Why Separate Configs Matter"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Production tsconfig"}),": Strict, no ",(0,i.jsx)(n.code,{children:"noEmit"}),", emit actual output"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Test/Lint tsconfig"}),": Can be more lenient, focuses on analysis not emission"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Prevents:"})," Test-only code affecting production type integrity"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"strictness-inheritance-pattern",children:"Strictness Inheritance Pattern"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Base config (",(0,i.jsx)(n.code,{children:"tsconfig.base.json"}),") sets foundation rules"]}),"\n",(0,i.jsx)(n.li,{children:"Specific configs override/relax as needed per context"}),"\n",(0,i.jsxs)(n.li,{children:["Test contexts naturally relax ",(0,i.jsx)(n.code,{children:"exactOptionalPropertyTypes"})," and similar strict\npatterns"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"2-eslint-community-patterns",children:"2. ESLint Community Patterns"}),"\n",(0,i.jsx)(n.h4,{id:"official-pattern-file-specific-overrides-antfueslint-config-trust-score-10",children:"Official Pattern: File-Specific Overrides (antfu/eslint-config, Trust Score 10)"}),"\n",(0,i.jsx)(n.p,{children:"From the most authoritative ESLint configuration library:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// eslint.config.js\nimport antfu from '@antfu/eslint-config'\n\nexport default antfu(\n  {\n    // Base rules for everything\n  },\n  {\n    // FILE-SPECIFIC OVERRIDE for tests\n    files: ['**/*.test.ts', '**/__tests__/**'],\n    rules: {\n      '@typescript-eslint/no-explicit-any': 'off',\n      'no-console': 'off',\n      // ... test-specific relaxations\n    },\n  },\n)\n"})}),"\n",(0,i.jsx)(n.h4,{id:"why-this-works",children:"Why This Works"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["ESLint supports ",(0,i.jsx)(n.strong,{children:"file-scoped rule overrides"})," in flat config"]}),"\n",(0,i.jsx)(n.li,{children:"Test files can have different rules than production code"}),"\n",(0,i.jsx)(n.li,{children:"No need to exclude tests entirely; instead, tailor the rules"}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"benefits-over-exclusion",children:"Benefits Over Exclusion"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Tests are still linted (consistent formatting, naming)"}),"\n",(0,i.jsx)(n.li,{children:"But test-specific patterns (mocks, any casts, console logs) are allowed"}),"\n",(0,i.jsx)(n.li,{children:"Catches real issues while allowing testing patterns"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"3-vitest-best-practices-eslint-plugin-vitest-trust-score-83",children:"3. Vitest Best Practices (eslint-plugin-vitest, Trust Score 8.3)"}),"\n",(0,i.jsx)(n.h4,{id:"configuration-pattern-for-test-overrides",children:"Configuration Pattern for Test Overrides"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "overrides": [\n    {\n      "files": ["test/**"],\n      "plugins": ["vitest"],\n      "rules": {\n        // Disable general rules in test files\n        "@typescript-eslint/unbound-method": "off",\n        // Enable test-specific variants\n        "vitest/unbound-method": "error"\n      }\n    }\n  ]\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"test-file-patterns",children:"Test File Patterns"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Naming conventions"}),": ",(0,i.jsx)(n.code,{children:"*.test.ts"}),", ",(0,i.jsx)(n.code,{children:"*.spec.ts"}),", ",(0,i.jsx)(n.code,{children:"__tests__/**"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Console allowance"}),": Test files should allow ",(0,i.jsx)(n.code,{children:"console.log"})," for debugging"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Type strictness"}),": Can relax for test doubles and mocks"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"application-to-imessage-timeline",children:"Application to imessage-timeline"}),"\n",(0,i.jsx)(n.h3,{id:"current-issue",children:"Current Issue"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tsconfig.eslint.json"})," is checking test files with\n",(0,i.jsx)(n.code,{children:"exactOptionalPropertyTypes: true"})]}),"\n",(0,i.jsxs)(n.li,{children:["Test builders create ",(0,i.jsx)(n.code,{children:"Partial<Message>"})," with undefined values"]}),"\n",(0,i.jsxs)(n.li,{children:["Type incompatibility: ",(0,i.jsx)(n.code,{children:"undefined"})," not assignable to ",(0,i.jsx)(n.code,{children:"string | null"})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"root-cause",children:"Root Cause"}),"\n",(0,i.jsx)(n.p,{children:"Test helper builders intentionally create flexible object structures that don't\nmatch strict schema definitions. This is normal and acceptable."}),"\n",(0,i.jsx)(n.h3,{id:"recommended-solution",children:"Recommended Solution"}),"\n",(0,i.jsx)(n.h4,{id:"option-a-exclude-tests-from-lint-typecheck-recommended",children:"Option A: Exclude Tests from Lint Typecheck (RECOMMENDED)"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Rationale:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Aligns with TypeScript official patterns (separate tsconfig files)"}),"\n",(0,i.jsx)(n.li,{children:"Tests are validated by Vitest runtime"}),"\n",(0,i.jsx)(n.li,{children:"Lint typecheck focuses on production code"}),"\n",(0,i.jsx)(n.li,{children:"Simpler to maintain"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Implementation:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'// tsconfig.eslint.json\n{\n  "compilerOptions": { "noEmit": true },\n  "exclude": ["**/*.test.ts", "**/*.spec.ts", "**/__tests__/**", "tests/**"],\n  "include": ["src/**/*.ts", "scripts/**/*.ts"]\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Rationale:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Source code ",(0,i.jsx)(n.code,{children:"src/**"})," must typecheck cleanly"]}),"\n",(0,i.jsx)(n.li,{children:"Scripts must typecheck cleanly"}),"\n",(0,i.jsx)(n.li,{children:"Tests have their own runtime validation via Vitest"}),"\n",(0,i.jsx)(n.li,{children:"Separate concerns: lint \u2260 test validation"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"option-b-relax-strictness-selectively-if-including-tests",children:"Option B: Relax Strictness Selectively (if including tests)"}),"\n",(0,i.jsx)(n.p,{children:"If tests must be linted for type safety:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'// tsconfig.eslint.json - if tests must be included\n{\n  "compilerOptions": {\n    "exactOptionalPropertyTypes": false, // <-- Relax for test flexibility\n    "noEmit": true,\n    "strict": true\n  },\n  "exclude": ["node_modules", "dist"]\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Trade-off:"})," Weakens type safety for test code (still better than no checking)"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"comparison-table",children:"Comparison Table"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Aspect"}),(0,i.jsx)(n.th,{children:"Option A (Exclude Tests)"}),(0,i.jsx)(n.th,{children:"Option B (Relax Strictness)"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Aligns with TypeScript docs"})}),(0,i.jsx)(n.td,{children:"\u2705 Yes"}),(0,i.jsx)(n.td,{children:"\u274c No"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Preserves production strictness"})}),(0,i.jsx)(n.td,{children:"\u2705 Full strict checking on src/"}),(0,i.jsx)(n.td,{children:"\u26a0\ufe0f Weaker overall"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Maintenance burden"})}),(0,i.jsx)(n.td,{children:"\u2705 Low"}),(0,i.jsx)(n.td,{children:"\u26a0\ufe0f Medium"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Test validation"})}),(0,i.jsx)(n.td,{children:"\u2705 Vitest runtime"}),(0,i.jsx)(n.td,{children:"\u26a0\ufe0f Limited lint checks"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Follows antfu/ESLint"})}),(0,i.jsx)(n.td,{children:"\u2705 Use ESLint overrides"}),(0,i.jsx)(n.td,{children:"\u2705 Separate strictness"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Recommended for"})}),(0,i.jsx)(n.td,{children:"Libraries, production code"}),(0,i.jsx)(n.td,{children:"Legacy mixed strictness"})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"implementation-plan",children:"Implementation Plan"}),"\n",(0,i.jsx)(n.h3,{id:"phase-1-update-tsconfigeslintjson-exclude-tests",children:"Phase 1: Update tsconfig.eslint.json (EXCLUDE TESTS)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "compilerOptions": {\n    "noEmit": true,\n    "paths": {\n      "#enrich/*": ["./src/enrich/*"],\n      "#ingest/*": ["./src/ingest/*"],\n      "#normalize/*": ["./src/normalize/*"],\n      "#render/*": ["./src/render/*"],\n      "#schema/*": ["./src/schema/*"]\n    }\n  },\n  "exclude": [\n    "node_modules",\n    "dist",\n    "**/*.test.ts",\n    "**/*.spec.ts",\n    "**/__tests__/**",\n    "tests/**"\n  ],\n  "extends": "./tsconfig.base.json",\n  "include": ["src/**/*.ts", "scripts/**/*.ts", "vitest.config.ts"]\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Choose Option A (Exclude Tests from Lint Typecheck)"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Reasoning:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Official alignment"}),": Matches TypeScript handbook patterns"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Community consensus"}),": Both antfu (ESLint) and Vitest recommend file-scoped\noverrides, not strictness changes"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Clear separation"}),": Production code = strict, tests = linted but flexible"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Maintainability"}),": No need to track test-specific strictness exceptions"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Precedent"}),": Major projects (Vue, Angular, Vite) all use this pattern"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Exceptions to handle with ESLint overrides:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"no-console"}),": off in tests (for debugging)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"@typescript-eslint/no-explicit-any"}),": off in test helpers (for mock factories)"]}),"\n",(0,i.jsx)(n.li,{children:"No need to change TypeScript strictness at all"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["TypeScript Handbook:\n",(0,i.jsx)(n.a,{href:"https://www.typescriptlang.org/docs/handbook/project-references.html",children:"Project References"})]}),"\n",(0,i.jsxs)(n.li,{children:["antfu/eslint-config:\n",(0,i.jsx)(n.a,{href:"https://github.com/antfu/eslint-config#override-eslint-rules-for-specific-files",children:"File-Specific Overrides"})]}),"\n",(0,i.jsxs)(n.li,{children:["Vitest ESLint Plugin:\n",(0,i.jsx)(n.a,{href:"https://github.com/vitest-dev/eslint-plugin-vitest",children:"Configuration Examples"})]}),"\n",(0,i.jsx)(n.li,{children:"TypeScript 5.7+ Docs: tsconfig.json project configuration"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}}}]);