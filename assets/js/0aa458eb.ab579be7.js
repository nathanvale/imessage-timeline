"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[8207],{4266:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>o,frontMatter:()=>t,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"imessage-pipeline-usage","title":"iMessage Pipeline Usage Guide","description":"Version 2025-10-19 Project: iMessage Timeline","source":"@site/docs/imessage-pipeline-usage.md","sourceDirName":".","slug":"/imessage-pipeline-usage","permalink":"/imessage-timeline/docs/imessage-pipeline-usage","draft":false,"unlisted":false,"editUrl":"https://github.com/nathanvale/imessage-timeline/tree/main/website/docs/imessage-pipeline-usage.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"iMessage Pipeline Troubleshooting Guide","permalink":"/imessage-timeline/docs/imessage-pipeline-troubleshooting"},"next":{"title":"Logging and sinks","permalink":"/imessage-timeline/docs/logging"}}');var r=i(6801),d=i(5705);const t={},l="iMessage Pipeline Usage Guide",a={},c=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"Installation",id:"installation",level:2},{value:"From Source",id:"from-source",level:3},{value:"Package Manager",id:"package-manager",level:3},{value:"Environment Setup",id:"environment-setup",level:2},{value:"Required Environment Variables",id:"required-environment-variables",level:3},{value:"Obtaining API Keys",id:"obtaining-api-keys",level:3},{value:"Gemini API Key",id:"gemini-api-key",level:4},{value:"Firecrawl API Key (Optional)",id:"firecrawl-api-key-optional",level:4},{value:"Pipeline Stages",id:"pipeline-stages",level:2},{value:"Stage 1: Ingest",id:"stage-1-ingest",level:3},{value:"Stage 2: Normalize-Link",id:"stage-2-normalize-link",level:3},{value:"Stage 3: Enrich-AI",id:"stage-3-enrich-ai",level:3},{value:"Stage 4: Render-Markdown",id:"stage-4-render-markdown",level:3},{value:"End-to-End Workflow",id:"end-to-end-workflow",level:2},{value:"Example: Full Pipeline with Real Data",id:"example-full-pipeline-with-real-data",level:3},{value:"1. Export Messages from iMazing",id:"1-export-messages-from-imazing",level:4},{value:"2. Prepare Environment",id:"2-prepare-environment",level:4},{value:"3. Run Ingest Stage",id:"3-run-ingest-stage",level:4},{value:"4. Run Normalize-Link Stage",id:"4-run-normalize-link-stage",level:4},{value:"5. Run Enrich-AI Stage",id:"5-run-enrich-ai-stage",level:4},{value:"6. Run Render-Markdown Stage",id:"6-run-render-markdown-stage",level:4},{value:"7. View in Obsidian",id:"7-view-in-obsidian",level:4},{value:"Configuration Reference",id:"configuration-reference",level:2},{value:"Global Configuration File",id:"global-configuration-file",level:3},{value:"Configuration Precedence",id:"configuration-precedence",level:3},{value:"CLI Commands",id:"cli-commands",level:2},{value:"1. ingest-csv",id:"1-ingest-csv",level:3},{value:"2. ingest-db",id:"2-ingest-db",level:3},{value:"3. normalize-link",id:"3-normalize-link",level:3},{value:"4. enrich-ai",id:"4-enrich-ai",level:3},{value:"5. render-markdown",id:"5-render-markdown",level:3},{value:"Advanced Usage",id:"advanced-usage",level:2},{value:"Batch Processing Multiple Contacts",id:"batch-processing-multiple-contacts",level:3},{value:"Incremental Updates (Daily Sync)",id:"incremental-updates-daily-sync",level:3},{value:"Custom Enrichment Providers",id:"custom-enrichment-providers",level:3},{value:"Next Steps",id:"next-steps",level:2}];function h(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"imessage-pipeline-usage-guide",children:"iMessage Pipeline Usage Guide"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Version"}),": 1.0 ",(0,r.jsx)(n.strong,{children:"Last Updated"}),": 2025-10-19 ",(0,r.jsx)(n.strong,{children:"Project"}),": iMessage Timeline\nRefactor"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#quick-start",children:"Quick Start"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#installation",children:"Installation"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#environment-setup",children:"Environment Setup"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#pipeline-stages",children:"Pipeline Stages"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#end-to-end-workflow",children:"End-to-End Workflow"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#configuration-reference",children:"Configuration Reference"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#cli-commands",children:"CLI Commands"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#advanced-usage",children:"Advanced Usage"})}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Prerequisites"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Node.js \u226522.20"}),"\n",(0,r.jsx)(n.li,{children:"pnpm package manager"}),"\n",(0,r.jsx)(n.li,{children:"Gemini API key (for enrichment)"}),"\n",(0,r.jsx)(n.li,{children:"Firecrawl API key (optional, for link enrichment)"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Minimal workflow"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# 1. Install dependencies\npnpm install\n\n# 2. Set up environment\ncp .env.example .env\n# Edit .env and add your API keys\n\n# 3. Run the pipeline\npnpm dev ingest-csv --input messages.csv --output ingested.json\npnpm dev normalize-link --input ingested.json --output normalized.json\npnpm dev enrich-ai --input normalized.json --output enriched.json\npnpm dev render-markdown --input enriched.json --output-dir ./timeline\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,r.jsx)(n.h3,{id:"from-source",children:"From Source"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Clone repository\ngit clone https://github.com/yourusername/imessage-timeline.git\ncd imessage-timeline\n\n# Install dependencies\npnpm install\n\n# Build TypeScript\npnpm build\n\n# Run tests (optional)\npnpm test\n"})}),"\n",(0,r.jsx)(n.h3,{id:"package-manager",children:"Package Manager"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Via npm\nnpm install -g imessage-timeline\n\n# Via pnpm\npnpm add -g imessage-timeline\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"environment-setup",children:"Environment Setup"}),"\n",(0,r.jsx)(n.h3,{id:"required-environment-variables",children:"Required Environment Variables"}),"\n",(0,r.jsxs)(n.p,{children:["Create a ",(0,r.jsx)(n.code,{children:".env"})," file in the project root:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Gemini API (Required for enrichment)\nGEMINI_API_KEY=your_gemini_api_key_here\n\n# Firecrawl API (Optional, for link enrichment)\nFIRECRAWL_API_KEY=your_firecrawl_api_key_here\n"})}),"\n",(0,r.jsx)(n.h3,{id:"obtaining-api-keys",children:"Obtaining API Keys"}),"\n",(0,r.jsx)(n.h4,{id:"gemini-api-key",children:"Gemini API Key"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Visit ",(0,r.jsx)(n.a,{href:"https://aistudio.google.com/app/apikey",children:"Google AI Studio"})]}),"\n",(0,r.jsx)(n.li,{children:'Click "Create API Key"'}),"\n",(0,r.jsxs)(n.li,{children:["Copy the key and add to ",(0,r.jsx)(n.code,{children:".env"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Pricing"}),": Free tier includes 15 RPM (requests per minute) with generous\nquotas."]}),"\n",(0,r.jsx)(n.h4,{id:"firecrawl-api-key-optional",children:"Firecrawl API Key (Optional)"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Visit ",(0,r.jsx)(n.a,{href:"https://www.firecrawl.dev/",children:"Firecrawl"})]}),"\n",(0,r.jsx)(n.li,{children:"Sign up for an account"}),"\n",(0,r.jsx)(n.li,{children:"Navigate to API Keys section"}),"\n",(0,r.jsxs)(n.li,{children:["Copy the key and add to ",(0,r.jsx)(n.code,{children:".env"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note"}),": Firecrawl is optional. Link enrichment will fall back to\nprovider-specific parsers (YouTube, Spotify, Twitter) without it."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"pipeline-stages",children:"Pipeline Stages"}),"\n",(0,r.jsx)(n.p,{children:"The pipeline consists of 4 main stages:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Ingest    \u2502 -> \u2502 Normalize-Link \u2502 -> \u2502 Enrich-AI \u2502 -> \u2502 Render-Markdown \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n   CSV or DB         Dedupe + Link         AI Analysis      Obsidian Format\n"})}),"\n",(0,r.jsx)(n.h3,{id:"stage-1-ingest",children:"Stage 1: Ingest"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose"}),": Import messages from CSV (iMazing) or macOS Messages.app database."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Inputs"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"CSV file exported from iMazing"}),"\n",(0,r.jsxs)(n.li,{children:["OR macOS Messages.app database (",(0,r.jsx)(n.code,{children:"chat.db"}),")"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Outputs"}),": JSON array of normalized message objects"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"See"}),": ",(0,r.jsx)(n.a,{href:"#1-ingest-csv",children:"Ingest Commands"})," for detailed usage"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"stage-2-normalize-link",children:"Stage 2: Normalize-Link"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose"}),": Deduplicate messages from multiple sources and link\nreplies/tapbacks."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Inputs"}),": JSON messages from Stage 1"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Outputs"}),": Deduplicated, linked messages with:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Reply threads (parent-child relationships)"}),"\n",(0,r.jsx)(n.li,{children:"Tapback associations"}),"\n",(0,r.jsx)(n.li,{children:"Unified GUIDs"}),"\n",(0,r.jsx)(n.li,{children:"Absolute file paths"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"See"}),": ",(0,r.jsx)(n.a,{href:"#3-normalize-link",children:"Normalize-Link Commands"})," for detailed usage"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"stage-3-enrich-ai",children:"Stage 3: Enrich-AI"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose"}),": Add AI-powered analysis to media messages."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Features"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Image Analysis"}),": HEIC/TIFF \u2192 JPG conversion + Gemini Vision captions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Audio Transcription"}),": Speech-to-text with speaker labels"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"PDF Summarization"}),": Extract key points from documents"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Video Metadata"}),": Basic metadata extraction (no transcription)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Link Enrichment"}),": Fetch context from URLs (Firecrawl + fallbacks)"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Inputs"}),": Normalized messages from Stage 2"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Outputs"}),": Enriched messages with ",(0,r.jsx)(n.code,{children:"media.enrichment"})," arrays"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"See"}),": ",(0,r.jsx)(n.a,{href:"#4-enrich-ai",children:"Enrich-AI Commands"})," for detailed usage"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"stage-4-render-markdown",children:"Stage 4: Render-Markdown"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose"}),": Generate Obsidian-compatible markdown timeline files."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Features"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Group by date + time-of-day (Morning/Afternoon/Evening)"}),"\n",(0,r.jsx)(n.li,{children:"Nested reply threads as blockquotes"}),"\n",(0,r.jsx)(n.li,{children:"Tapback emoji reactions"}),"\n",(0,r.jsxs)(n.li,{children:["Image embeds with ",(0,r.jsx)(n.code,{children:"![[wikilink]]"})," syntax"]}),"\n",(0,r.jsx)(n.li,{children:"Transcriptions and link contexts as blockquotes"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Inputs"}),": Enriched messages from Stage 3"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Outputs"}),": Markdown files in output directory"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"See"}),": ",(0,r.jsx)(n.a,{href:"#5-render-markdown",children:"Render-Markdown Commands"})," for detailed usage"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"end-to-end-workflow",children:"End-to-End Workflow"}),"\n",(0,r.jsx)(n.h3,{id:"example-full-pipeline-with-real-data",children:"Example: Full Pipeline with Real Data"}),"\n",(0,r.jsx)(n.p,{children:"This example demonstrates processing 3 months of iMessage history."}),"\n",(0,r.jsx)(n.h4,{id:"1-export-messages-from-imazing",children:"1. Export Messages from iMazing"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Connect iPhone to iMazing"}),"\n",(0,r.jsx)(n.li,{children:'Navigate to "Messages" \u2192 Select contact'}),"\n",(0,r.jsx)(n.li,{children:"Export \u2192 CSV format"}),"\n",(0,r.jsxs)(n.li,{children:["Save as ",(0,r.jsx)(n.code,{children:"melanie-messages.csv"})]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"2-prepare-environment",children:"2. Prepare Environment"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Create project directory\nmkdir imessage-analysis\ncd imessage-analysis\n\n# Install imessage-timeline\npnpm add imessage-timeline\n\n# Setup environment variables\ncat > .env << EOF\nGEMINI_API_KEY=AIzaSyD...your_key_here\nFIRECRAWL_API_KEY=fc-...your_key_here (optional)\nEOF\n"})}),"\n",(0,r.jsx)(n.h4,{id:"3-run-ingest-stage",children:"3. Run Ingest Stage"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pnpm imessage-timeline ingest-csv \\\n  --input melanie-messages.csv \\\n  --output ingested.json \\\n  --attachment-roots ~/Library/Messages/Attachments\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Expected output"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u2713 Parsed 2,847 messages from CSV\n\u2713 Split into 3,104 message objects (text + media)\n\u2713 Resolved 1,423 attachment paths\n\u26a0 Missing files: 12 (logged to ingested-errors.json)\n\u2713 Wrote ingested.json (4.2 MB)\n"})}),"\n",(0,r.jsx)(n.h4,{id:"4-run-normalize-link-stage",children:"4. Run Normalize-Link Stage"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pnpm imessage-timeline normalize-link \\\n  --input ingested.json \\\n  --output normalized.json \\\n  --verbose\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Expected output"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u2713 Loaded 3,104 messages\n\u2713 Linked 847 replies (783 via DB, 64 via heuristics)\n\u2713 Linked 234 tapbacks\n\u2713 Deduplicated: 3,104 \u2192 3,098 (6 duplicates removed)\n\u2713 Validated all messages against schema\n\u2713 Wrote normalized.json (4.1 MB)\n"})}),"\n",(0,r.jsx)(n.h4,{id:"5-run-enrich-ai-stage",children:"5. Run Enrich-AI Stage"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pnpm imessage-timeline enrich-ai \\\n  --input normalized.json \\\n  --output enriched.json \\\n  --checkpoint-interval 50 \\\n  --rate-limit 1000 \\\n  --resume\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Expected output"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u2713 Loaded 3,098 messages (823 media attachments)\n\u2192 Enriching images: 542 HEIC/TIFF files\n  \u2192 Converting HEIC to JPG previews... [=============    ] 75% (407/542)\n  \u2192 Analyzing with Gemini Vision... [============     ] 70% (380/542)\n\u2713 Checkpoint written: enrich-checkpoint-500.json\n\u2192 Enriching audio: 134 M4A files\n  \u2192 Transcribing with Gemini Audio... [===========      ] 65% (87/134)\n\u2713 Checkpoint written: enrich-checkpoint-600.json\n\u2192 Enriching links: 89 URLs\n  \u2192 Fetching contexts... [==================] 100% (89/89)\n\u2713 Completed in 42min 18s\n\u2713 Wrote enriched.json (6.7 MB)\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Resume capability"}),": If interrupted (Ctrl+C or API error), run the same\ncommand with ",(0,r.jsx)(n.code,{children:"--resume"})," to continue from the last checkpoint."]}),"\n",(0,r.jsx)(n.h4,{id:"6-run-render-markdown-stage",children:"6. Run Render-Markdown Stage"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pnpm imessage-timeline render-markdown \\\n  --input enriched.json \\\n  --output-dir ./timeline \\\n  --date-range 2024-10-01:2024-12-31\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Expected output"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u2713 Loaded 3,098 enriched messages\n\u2713 Grouping by date: 92 days with messages\n\u2713 Rendering markdown files...\n  \u2192 2024-10-01.md (34 messages)\n  \u2192 2024-10-02.md (28 messages)\n  ...\n  \u2192 2024-12-31.md (41 messages)\n\u2713 Wrote 92 markdown files to ./timeline/\n\u2713 Total size: 8.4 MB\n"})}),"\n",(0,r.jsx)(n.h4,{id:"7-view-in-obsidian",children:"7. View in Obsidian"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Open Obsidian"}),"\n",(0,r.jsx)(n.li,{children:"File \u2192 Open Vault"}),"\n",(0,r.jsxs)(n.li,{children:["Select ",(0,r.jsx)(n.code,{children:"./timeline"})," directory"]}),"\n",(0,r.jsxs)(n.li,{children:["Navigate to any date file (e.g., ",(0,r.jsx)(n.code,{children:"2024-10-15.md"}),")"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Result"}),": Fully formatted timeline with:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 Nested reply threads"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Tapback emoji reactions"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Embedded images with captions"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Audio transcriptions"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Link previews with context"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Clickable deep-link anchors"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"configuration-reference",children:"Configuration Reference"}),"\n",(0,r.jsx)(n.h3,{id:"global-configuration-file",children:"Global Configuration File"}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"imessage-config.json"})," in project root:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "attachmentRoots": [\n    "/Users/yourname/Library/Messages/Attachments",\n    "/Volumes/Backup/old-attachments"\n  ],\n  "enrichment": {\n    "checkpointInterval": 100,\n    "enableAudioTranscription": true,\n    "enableLinkEnrichment": true,\n    "enableVisionAnalysis": true,\n    "forceRefresh": false,\n    "imageCacheDir": "./.cache/images"\n  },\n  "firecrawl": {\n    "apiKey": "${FIRECRAWL_API_KEY}",\n    "enabled": true\n  },\n  "gemini": {\n    "apiKey": "${GEMINI_API_KEY}",\n    "maxRetries": 3,\n    "model": "gemini-1.5-pro",\n    "rateLimitDelay": 1000\n  },\n  "render": {\n    "groupByTimeOfDay": true,\n    "maxNestingDepth": 10,\n    "renderRepliesAsNested": true,\n    "renderTapbacksAsEmoji": true\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"configuration-precedence",children:"Configuration Precedence"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"CLI flags"})," (highest priority)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Environment variables"})," (",(0,r.jsx)(n.code,{children:".env"})," file)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Config file"})," (",(0,r.jsx)(n.code,{children:"imessage-config.json"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Built-in defaults"})," (lowest priority)"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Uses GEMINI_API_KEY from .env\npnpm dev enrich-ai --input messages.json --output enriched.json\n\n# Overrides with CLI flag\npnpm dev enrich-ai --input messages.json --output enriched.json --gemini-api-key YOUR_KEY\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"cli-commands",children:"CLI Commands"}),"\n",(0,r.jsx)(n.h3,{id:"1-ingest-csv",children:"1. ingest-csv"}),"\n",(0,r.jsx)(n.p,{children:"Import messages from iMazing CSV export."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Syntax"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"imessage-timeline ingest-csv [options]\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Options"}),":"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Flag"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--input <path>"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.em,{children:"(required)"})}),(0,r.jsx)(n.td,{children:"Path to CSV file"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--output <path>"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ingested.json"})}),(0,r.jsx)(n.td,{children:"Output JSON file"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--attachment-roots <paths...>"})}),(0,r.jsx)(n.td,{children:"string[]"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"~/Library/Messages/Attachments"})}),(0,r.jsx)(n.td,{children:"Attachment search directories"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--verbose"})}),(0,r.jsx)(n.td,{children:"boolean"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"false"})}),(0,r.jsx)(n.td,{children:"Detailed logging"})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"imessage-timeline ingest-csv \\\n  --input ~/Desktop/export.csv \\\n  --output ./data/ingested.json \\\n  --attachment-roots ~/Library/Messages/Attachments /Volumes/Backup/attachments \\\n  --verbose\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Output"}),": JSON file with structure:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "messages": [\n    {\n      "date": "2024-10-15T14:23:45.000Z",\n      "guid": "csv:1:0",\n      "isFromMe": true,\n      "messageKind": "text",\n      "metadata": {\n        "csvLineNumber": 2,\n        "source": "csv"\n      },\n      "service": "iMessage",\n      "text": "Hello world"\n    }\n  ],\n  "metadata": {\n    "createdAt": "2025-10-19T22:00:00.000Z",\n    "source": "csv",\n    "totalMessages": 1234,\n    "version": "1.0"\n  }\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"2-ingest-db",children:"2. ingest-db"}),"\n",(0,r.jsx)(n.p,{children:"Import messages from macOS Messages.app database."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Syntax"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"imessage-timeline ingest-db [options]\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Options"}),":"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Flag"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--db-path <path>"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"~/Library/Messages/chat.db"})}),(0,r.jsx)(n.td,{children:"Path to chat.db"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--output <path>"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ingested-db.json"})}),(0,r.jsx)(n.td,{children:"Output JSON file"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--contact <identifier>"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.em,{children:"(optional)"})}),(0,r.jsx)(n.td,{children:"Filter by phone/email"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--date-range <start:end>"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.em,{children:"(optional)"})}),(0,r.jsxs)(n.td,{children:["Date range (YYYY-MM-DD",":YYYY-MM-DD",")"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--attachment-roots <paths...>"})}),(0,r.jsx)(n.td,{children:"string[]"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"~/Library/Messages/Attachments"})}),(0,r.jsx)(n.td,{children:"Attachment directories"})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'imessage-timeline ingest-db \\\n  --db-path ~/Library/Messages/chat.db \\\n  --output ./data/ingested-db.json \\\n  --contact "+61412345678" \\\n  --date-range 2024-01-01:2024-12-31\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note"}),": Requires full disk access permission on macOS (System Preferences \u2192\nSecurity & Privacy \u2192 Privacy \u2192 Full Disk Access)."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"3-normalize-link",children:"3. normalize-link"}),"\n",(0,r.jsx)(n.p,{children:"Deduplicate messages and link replies/tapbacks."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Syntax"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"imessage-timeline normalize-link [options]\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Options"}),":"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Flag"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--input <path>"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.em,{children:"(required)"})}),(0,r.jsx)(n.td,{children:"Input JSON from ingest stage"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--output <path>"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"normalized.json"})}),(0,r.jsx)(n.td,{children:"Output JSON file"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--merge-csv-db"})}),(0,r.jsx)(n.td,{children:"boolean"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"false"})}),(0,r.jsx)(n.td,{children:"Merge CSV and DB sources"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--csv-input <path>"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.em,{children:"(optional)"})}),(0,r.jsx)(n.td,{children:"CSV JSON (if merging)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--db-input <path>"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.em,{children:"(optional)"})}),(0,r.jsx)(n.td,{children:"DB JSON (if merging)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--verbose"})}),(0,r.jsx)(n.td,{children:"boolean"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"false"})}),(0,r.jsx)(n.td,{children:"Detailed logging"})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example (single source)"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"imessage-timeline normalize-link \\\n  --input ingested.json \\\n  --output normalized.json\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example (merge CSV + DB)"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"imessage-timeline normalize-link \\\n  --merge-csv-db \\\n  --csv-input ingested-csv.json \\\n  --db-input ingested-db.json \\\n  --output normalized-merged.json \\\n  --verbose\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Output"}),": Normalized JSON with linked messages:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "messages": [\n    {\n      "guid": "abc-123",\n      "messageKind": "text",\n      "replies": ["def-456"],\n      "text": "What do you think?",\n      "threadTargetGuid": null\n    },\n    {\n      "guid": "def-456",\n      "messageKind": "text",\n      "text": "Sounds great!",\n      "threadTargetGuid": "abc-123"\n    }\n  ],\n  "metadata": {\n    "duplicatesRemoved": 6,\n    "inputCount": 3104,\n    "outputCount": 3098,\n    "repliesLinked": 847,\n    "source": "normalize-link",\n    "tapbacksLinked": 234\n  }\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"4-enrich-ai",children:"4. enrich-ai"}),"\n",(0,r.jsx)(n.p,{children:"Add AI-powered analysis to media messages."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Syntax"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"imessage-timeline enrich-ai [options]\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Options"}),":"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Flag"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--input <path>"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.em,{children:"(required)"})}),(0,r.jsx)(n.td,{children:"Normalized JSON"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--output <path>"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"enriched.json"})}),(0,r.jsx)(n.td,{children:"Output JSON"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--checkpoint-interval <n>"})}),(0,r.jsx)(n.td,{children:"number"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"100"})}),(0,r.jsx)(n.td,{children:"Write checkpoint every N items"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--resume"})}),(0,r.jsx)(n.td,{children:"boolean"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"false"})}),(0,r.jsx)(n.td,{children:"Resume from last checkpoint"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--force-refresh"})}),(0,r.jsx)(n.td,{children:"boolean"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"false"})}),(0,r.jsx)(n.td,{children:"Re-enrich existing enrichments"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--rate-limit <ms>"})}),(0,r.jsx)(n.td,{children:"number"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"1000"})}),(0,r.jsx)(n.td,{children:"Delay between API calls (ms)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--max-retries <n>"})}),(0,r.jsx)(n.td,{children:"number"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"3"})}),(0,r.jsx)(n.td,{children:"Retry attempts for 5xx errors"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--gemini-api-key <key>"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"$GEMINI_API_KEY"})}),(0,r.jsx)(n.td,{children:"Override API key"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--enable-vision"})}),(0,r.jsx)(n.td,{children:"boolean"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"true"})}),(0,r.jsx)(n.td,{children:"Enable image analysis"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--enable-audio"})}),(0,r.jsx)(n.td,{children:"boolean"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"true"})}),(0,r.jsx)(n.td,{children:"Enable transcription"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--enable-links"})}),(0,r.jsx)(n.td,{children:"boolean"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"true"})}),(0,r.jsx)(n.td,{children:"Enable link enrichment"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--image-cache-dir <path>"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"./.cache/images"})}),(0,r.jsx)(n.td,{children:"Preview cache directory"})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example (standard run)"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"imessage-timeline enrich-ai \\\n  --input normalized.json \\\n  --output enriched.json \\\n  --checkpoint-interval 50 \\\n  --rate-limit 1500\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example (resume after interruption)"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"imessage-timeline enrich-ai \\\n  --input normalized.json \\\n  --output enriched.json \\\n  --resume\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example (disable certain enrichments)"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"imessage-timeline enrich-ai \\\n  --input normalized.json \\\n  --output enriched.json \\\n  --enable-audio false \\\n  --enable-links false\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Checkpoint Files"}),": Automatically created in\n",(0,r.jsx)(n.code,{children:"./checkpoints/enrich-checkpoint-<index>.json"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Resume behavior"}),": Continues from the last successfully enriched message.\nIdempotency ensures no duplicate enrichments."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"5-render-markdown",children:"5. render-markdown"}),"\n",(0,r.jsx)(n.p,{children:"Generate Obsidian-compatible markdown timeline files."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Syntax"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"imessage-timeline render-markdown [options]\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Options"}),":"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Flag"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--input <path>"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.em,{children:"(required)"})}),(0,r.jsx)(n.td,{children:"Enriched JSON"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--output-dir <path>"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"./timeline"})}),(0,r.jsx)(n.td,{children:"Output directory"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--date-range <start:end>"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.em,{children:"(all dates)"})}),(0,r.jsx)(n.td,{children:"Filter by date range"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--group-by-time"})}),(0,r.jsx)(n.td,{children:"boolean"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"true"})}),(0,r.jsx)(n.td,{children:"Group by time-of-day"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--nested-replies"})}),(0,r.jsx)(n.td,{children:"boolean"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"true"})}),(0,r.jsx)(n.td,{children:"Render replies as nested"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--max-nesting-depth <n>"})}),(0,r.jsx)(n.td,{children:"number"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"10"})}),(0,r.jsx)(n.td,{children:"Max reply nesting levels"})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"imessage-timeline render-markdown \\\n  --input enriched.json \\\n  --output-dir ./timeline \\\n  --date-range 2024-10-01:2024-10-31\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Output Structure"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"timeline/\n\u251c\u2500\u2500 2024-10-01.md\n\u251c\u2500\u2500 2024-10-02.md\n\u251c\u2500\u2500 ...\n\u2514\u2500\u2500 2024-10-31.md\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Sample Output"})," (",(0,r.jsx)(n.code,{children:"2024-10-15.md"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-markdown",children:"# 2024-10-15\n\n## Morning (00:00 - 11:59)\n\n### 08:23 - You\n\nGood morning! \u2600\ufe0f\n\n### 08:25 - Melanie\n\nMorning! How'd you sleep?\n\n> **You** (08:26): Really well, thanks! \ud83d\ude0a\n\n\u2764\ufe0f Melanie\n\n## Afternoon (12:00 - 17:59)\n\n### 14:30 - Melanie\n\nCheck out this photo!\n\n![[IMG_1234.heic]]\n\n> _Gemini Vision Analysis_: A beautiful sunset over the ocean with vibrant\n> orange and pink hues reflecting on the water.\n\n## Evening (18:00 - 23:59)\n\n### 19:45 - You\n\nLet's meet at this place: https://example.com/restaurant\n\n> _Link Context_:\n> **[Best Restaurant in Town - Example Dining](https://example.com/restaurant)**\n> Award-winning restaurant featuring modern Australian cuisine with seasonal\n> menus and waterfront views.\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"advanced-usage",children:"Advanced Usage"}),"\n",(0,r.jsx)(n.h3,{id:"batch-processing-multiple-contacts",children:"Batch Processing Multiple Contacts"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# process-all-contacts.sh\n\nCONTACTS=(\n  "+61412345678:melanie"\n  "+61498765432:john"\n  "alice@example.com:alice"\n)\n\nfor contact_pair in "${CONTACTS[@]}"; do\n  IFS=\':\' read -r contact name <<< "$contact_pair"\n\n  echo "Processing $name ($contact)..."\n\n  # Ingest from DB\n  imessage-timeline ingest-db \\\n    --contact "$contact" \\\n    --output "data/${name}-ingested.json"\n\n  # Normalize\n  imessage-timeline normalize-link \\\n    --input "data/${name}-ingested.json" \\\n    --output "data/${name}-normalized.json"\n\n  # Enrich\n  imessage-timeline enrich-ai \\\n    --input "data/${name}-normalized.json" \\\n    --output "data/${name}-enriched.json" \\\n    --checkpoint-interval 50\n\n  # Render\n  imessage-timeline render-markdown \\\n    --input "data/${name}-enriched.json" \\\n    --output-dir "timeline/${name}"\n\n  echo "\u2713 Completed $name"\ndone\n\necho "\u2713 All contacts processed"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"incremental-updates-daily-sync",children:"Incremental Updates (Daily Sync)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# daily-sync.sh\n\nDATE=$(date +%Y-%m-%d)\nYESTERDAY=$(date -d "yesterday" +%Y-%m-%d)\n\n# Export yesterday\'s messages only\nimessage-timeline ingest-db \\\n  --date-range "$YESTERDAY:$DATE" \\\n  --output "data/daily-$DATE.json"\n\n# Merge with existing normalized data\nimessage-timeline normalize-link \\\n  --merge-csv-db \\\n  --csv-input "data/normalized-master.json" \\\n  --db-input "data/daily-$DATE.json" \\\n  --output "data/normalized-master.json"\n\n# Enrich new messages only (idempotency handles duplicates)\nimessage-timeline enrich-ai \\\n  --input "data/normalized-master.json" \\\n  --output "data/enriched-master.json"\n\n# Render updated timeline\nimessage-timeline render-markdown \\\n  --input "data/enriched-master.json" \\\n  --output-dir "./timeline" \\\n  --date-range "$YESTERDAY:$DATE"\n\necho "\u2713 Daily sync complete for $DATE"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"custom-enrichment-providers",children:"Custom Enrichment Providers"}),"\n",(0,r.jsx)(n.p,{children:"You can extend enrichment with custom providers:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// custom-provider.ts\nimport type { MediaEnrichment } from 'imessage-timeline'\n\nexport async function enrichWithCustomAPI(\n  mediaPath: string,\n): Promise<MediaEnrichment> {\n  const response = await fetch('https://your-api.com/analyze', {\n    method: 'POST',\n    body: JSON.stringify({ path: mediaPath }),\n  })\n\n  const data = await response.json()\n\n  return {\n    kind: 'custom_analysis',\n    summary: data.summary,\n    provider: 'custom-api',\n    model: 'custom-v1',\n    version: '1.0',\n    createdAt: new Date().toISOString(),\n  }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Then integrate in your workflow:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { renderMessages } from 'imessage-timeline'\nimport { enrichWithCustomAPI } from './custom-provider'\n\n// Load normalized messages\nconst messages = JSON.parse(readFileSync('normalized.json', 'utf-8'))\n\n// Apply custom enrichment\nfor (const msg of messages) {\n  if (msg.messageKind === 'media' && msg.media?.mediaKind === 'image') {\n    const enrichment = await enrichWithCustomAPI(msg.media.path)\n    msg.media.enrichment = msg.media.enrichment || []\n    msg.media.enrichment.push(enrichment)\n  }\n}\n\n// Continue with standard render\nconst markdown = renderMessages(messages)\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Troubleshooting"}),": See\n",(0,r.jsx)(n.a,{href:"/imessage-timeline/docs/imessage-pipeline-troubleshooting",children:"Troubleshooting Guide"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"API Reference"}),": See\n",(0,r.jsx)(n.a,{href:"/imessage-timeline/docs/imessage-pipeline-tech-spec",children:"Technical Specification"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Implementation Notes"}),": See\n",(0,r.jsx)(n.a,{href:"/imessage-timeline/docs/imessage-pipeline-refactor-report",children:"Refactor Report"})]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Document Version"}),": 1.0 ",(0,r.jsx)(n.strong,{children:"Author"}),": Generated from iMessage Pipeline\nimplementation ",(0,r.jsx)(n.strong,{children:"Last Updated"}),": 2025-10-19"]})]})}function o(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},5705:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>l});var s=i(7701);const r={},d=s.createContext(r);function t(e){const n=s.useContext(d);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(d.Provider,{value:n},e.children)}}}]);