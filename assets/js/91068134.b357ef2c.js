"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[9995],{5705:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>l});var s=i(7701);const t={},o=s.createContext(t);function r(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(o.Provider,{value:n},e.children)}},5742:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"npm-automation-token-setup","title":"NPM Automation Token Setup Guide","description":"TL;DR: Use granular automation tokens with read/write permissions for","source":"@site/docs/npm-automation-token-setup.md","sourceDirName":".","slug":"/npm-automation-token-setup","permalink":"/imessage-timeline/docs/npm-automation-token-setup","draft":false,"unlisted":false,"editUrl":"https://github.com/nathanvale/imessage-timeline/tree/main/website/docs/npm-automation-token-setup.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Logging and sinks","permalink":"/imessage-timeline/docs/logging"},"next":{"title":"Package Hygiene & Metadata Quality","permalink":"/imessage-timeline/docs/package-hygiene"}}');var t=i(6801),o=i(5705);const r={},l="NPM Automation Token Setup Guide",c={},d=[{value:"Why Automation Tokens?",id:"why-automation-tokens",level:2},{value:"Step-by-Step Setup",id:"step-by-step-setup",level:2},{value:"1. Go to NPM Token Page",id:"1-go-to-npm-token-page",level:3},{value:"2. Click &quot;Generate New Token&quot;",id:"2-click-generate-new-token",level:3},{value:"3. Select Token Type",id:"3-select-token-type",level:3},{value:"4. Configure Token Permissions",id:"4-configure-token-permissions",level:3},{value:"5. Copy the Token",id:"5-copy-the-token",level:3},{value:"6. Add to GitHub Secrets",id:"6-add-to-github-secrets",level:3},{value:"7. Verify It Works",id:"7-verify-it-works",level:3},{value:"Security Best Practices",id:"security-best-practices",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"&quot;403 Forbidden&quot; Error",id:"403-forbidden-error",level:3},{value:"&quot;401 Unauthorized&quot; Error",id:"401-unauthorized-error",level:3},{value:"Token Expired",id:"token-expired",level:3},{value:"Rotation Schedule",id:"rotation-schedule",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function a(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"npm-automation-token-setup-guide",children:"NPM Automation Token Setup Guide"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"TL;DR:"})," Use granular automation tokens with read/write permissions for\n",(0,t.jsx)(n.code,{children:"imessage-timeline"})," only."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"why-automation-tokens",children:"Why Automation Tokens?"}),"\n",(0,t.jsx)(n.p,{children:"Regular tokens can publish ALL your packages. Automation tokens can be\nrestricted to specific packages."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Security:"})," If token leaks, damage is limited to this package only."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"step-by-step-setup",children:"Step-by-Step Setup"}),"\n",(0,t.jsx)(n.h3,{id:"1-go-to-npm-token-page",children:"1. Go to NPM Token Page"}),"\n",(0,t.jsxs)(n.p,{children:["Visit: ",(0,t.jsx)(n.a,{href:"https://www.npmjs.com/settings/YOUR_USERNAME/tokens",children:"https://www.npmjs.com/settings/YOUR_USERNAME/tokens"})]}),"\n",(0,t.jsx)(n.p,{children:"(Replace YOUR_USERNAME with your npm username)"}),"\n",(0,t.jsx)(n.h3,{id:"2-click-generate-new-token",children:'2. Click "Generate New Token"'}),"\n",(0,t.jsx)(n.p,{children:"Button is in the top right."}),"\n",(0,t.jsx)(n.h3,{id:"3-select-token-type",children:"3. Select Token Type"}),"\n",(0,t.jsxs)(n.p,{children:["Choose: ",(0,t.jsx)(n.strong,{children:"Automation"})]}),"\n",(0,t.jsx)(n.p,{children:'(Not "Publish" - automation tokens have better security)'}),"\n",(0,t.jsx)(n.h3,{id:"4-configure-token-permissions",children:"4. Configure Token Permissions"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Package permissions:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'Select: "Read and write"'}),"\n",(0,t.jsxs)(n.li,{children:["Package: ",(0,t.jsx)(n.code,{children:"imessage-timeline"})]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"IP Allowlist:"})," Leave empty (GitHub Actions IPs rotate)"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Expiration:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Recommended: 90 days"}),"\n",(0,t.jsx)(n.li,{children:"Set a calendar reminder to rotate"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"5-copy-the-token",children:"5. Copy the Token"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"IMPORTANT:"})," You only see this ONCE!"]}),"\n",(0,t.jsxs)(n.p,{children:["Format: ",(0,t.jsx)(n.code,{children:"npm_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"})]}),"\n",(0,t.jsx)(n.h3,{id:"6-add-to-github-secrets",children:"6. Add to GitHub Secrets"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Go to:\n",(0,t.jsx)(n.code,{children:"https://github.com/nathanvale/imessage-timeline/settings/secrets/actions"})]}),"\n",(0,t.jsx)(n.li,{children:'Click "New repository secret"'}),"\n",(0,t.jsxs)(n.li,{children:["Name: ",(0,t.jsx)(n.code,{children:"NPM_TOKEN"})]}),"\n",(0,t.jsx)(n.li,{children:"Value: Paste the token"}),"\n",(0,t.jsx)(n.li,{children:'Click "Add secret"'}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"7-verify-it-works",children:"7. Verify It Works"}),"\n",(0,t.jsx)(n.p,{children:"The token is used in these workflows:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:".github/workflows/changesets-manage-publish.yml"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:".github/workflows/alpha-snapshot.yml"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:".github/workflows/channel-release.yml"})}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:'Next time you merge a "Version Packages" PR, it will use this token to publish.'}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"security-best-practices",children:"Security Best Practices"}),"\n",(0,t.jsxs)(n.p,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"DO:"})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Use automation tokens (not classic tokens)"}),"\n",(0,t.jsx)(n.li,{children:"Set expiration dates"}),"\n",(0,t.jsx)(n.li,{children:"Rotate tokens every 90 days"}),"\n",(0,t.jsx)(n.li,{children:"Restrict to specific packages"}),"\n",(0,t.jsx)(n.li,{children:"Store in GitHub Secrets only"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["\u274c ",(0,t.jsx)(n.strong,{children:"DON'T:"})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'Use classic "Publish" tokens'}),"\n",(0,t.jsx)(n.li,{children:"Share tokens in chat/email"}),"\n",(0,t.jsx)(n.li,{children:"Commit tokens to git"}),"\n",(0,t.jsx)(n.li,{children:"Use tokens without expiration"}),"\n",(0,t.jsx)(n.li,{children:"Give tokens access to all packages"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(n.h3,{id:"403-forbidden-error",children:'"403 Forbidden" Error'}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Problem:"})," Token doesn't have permission to publish package"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:'Check token has "Read and write" permission'}),"\n",(0,t.jsxs)(n.li,{children:["Verify package name is ",(0,t.jsx)(n.code,{children:"imessage-timeline"})]}),"\n",(0,t.jsx)(n.li,{children:"Make sure you're an owner/maintainer of the package"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"401-unauthorized-error",children:'"401 Unauthorized" Error'}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Problem:"})," Token is invalid or expired"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Generate a new token following steps above"}),"\n",(0,t.jsxs)(n.li,{children:["Update GitHub secret ",(0,t.jsx)(n.code,{children:"NPM_TOKEN"})]}),"\n",(0,t.jsx)(n.li,{children:"Re-run the workflow"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"token-expired",children:"Token Expired"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Problem:"}),' Got email "Your npm token is expiring soon"']}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Generate a new token (same steps)"}),"\n",(0,t.jsxs)(n.li,{children:["Update GitHub secret ",(0,t.jsx)(n.code,{children:"NPM_TOKEN"})]}),"\n",(0,t.jsx)(n.li,{children:"Old token is automatically revoked"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"rotation-schedule",children:"Rotation Schedule"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Recommended:"})," Rotate tokens every 90 days"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Set calendar reminder for rotation date"}),"\n",(0,t.jsx)(n.li,{children:"Generate new token"}),"\n",(0,t.jsx)(n.li,{children:"Update GitHub secret"}),"\n",(0,t.jsx)(n.li,{children:"Old token automatically expires"}),"\n",(0,t.jsx)(n.li,{children:"Reset calendar reminder for 90 days later"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.npmjs.com/creating-and-viewing-access-tokens",children:"NPM Automation Tokens Docs"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.github.com/en/actions/security-guides/encrypted-secrets",children:"GitHub Actions Secrets"})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"docs/automated-release-workflow.md"})," - How publishing workflows use the token"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}}}]);