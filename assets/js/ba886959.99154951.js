"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[4481],{5705:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>a});var i=s(7701);const l={},r=i.createContext(l);function t(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),i.createElement(r.Provider,{value:n},e.children)}},8021:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>d,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"releases/changesets-canonical","title":"Canonical Changesets Flow \u2014 Zero-touch releases","description":"This document is both a human checklist and an AI agent playbook for end-to-end","source":"@site/docs/releases/changesets-canonical.md","sourceDirName":"releases","slug":"/releases/changesets-canonical","permalink":"/chatline/docs/releases/changesets-canonical","draft":false,"unlisted":false,"editUrl":"https://github.com/nathanvale/chatline/tree/main/website/docs/releases/changesets-canonical.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Release Channels & Prerelease Strategy","permalink":"/chatline/docs/release-channels"},"next":{"title":"SBOM Generation Review","permalink":"/chatline/docs/sbom-generation-review"}}');var l=s(6801),r=s(5705);const t={},a="Canonical Changesets Flow \u2014 Zero-touch releases",o={},c=[{value:"Quickstart (what you do)",id:"quickstart-what-you-do",level:2},{value:"What you (humans) do (details)",id:"what-you-humans-do-details",level:2},{value:"What the automation does",id:"what-the-automation-does",level:2},{value:"Labels, commands, and signals",id:"labels-commands-and-signals",level:2},{value:"Required checks (branch protection)",id:"required-checks-branch-protection",level:2},{value:"Notes for AI agents",id:"notes-for-ai-agents",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Reference scripts (package.json)",id:"reference-scripts-packagejson",level:2}];function h(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"canonical-changesets-flow--zero-touch-releases",children:"Canonical Changesets Flow \u2014 Zero-touch releases"})}),"\n",(0,l.jsx)(n.p,{children:"This document is both a human checklist and an AI agent playbook for end-to-end\nautomated releases using Changesets."}),"\n",(0,l.jsx)(n.h2,{id:"quickstart-what-you-do",children:"Quickstart (what you do)"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Use Conventional Commit PR titles"}),"\n"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"feat: \u2026 \u2192 minor"}),"\n",(0,l.jsx)(n.li,{children:"fix: \u2026 \u2192 patch"}),"\n",(0,l.jsx)(n.li,{children:"refactor!: \u2026 or BREAKING CHANGE: in body \u2192 major"}),"\n"]}),"\n",(0,l.jsxs)(n.ol,{start:"2",children:["\n",(0,l.jsx)(n.li,{children:"Don\u2019t worry about changesets"}),"\n"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"If you don\u2019t add one, the bot creates it from your PR title automatically."}),"\n"]}),"\n",(0,l.jsxs)(n.ol,{start:"3",children:["\n",(0,l.jsx)(n.li,{children:"Let CI merge and publish"}),"\n"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"A \u201cVersion Packages\u201d PR is opened by CI and auto-merged after checks; publish\nhappens automatically with tags and GitHub Release assets."}),"\n"]}),"\n",(0,l.jsxs)(n.ol,{start:"4",children:["\n",(0,l.jsx)(n.li,{children:"Optional prerelease streams"}),"\n"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Use the \u201cChangesets Pre-Mode Toggle\u201d workflow to enter/exit beta/rc/next."}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"That\u2019s it\u2014no manual tagging or npm publish."}),"\n",(0,l.jsx)(n.h2,{id:"what-you-humans-do-details",children:"What you (humans) do (details)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Write PR titles using Conventional Commit style:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"feat: ..."})," \u2192 minor release"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"fix: ..."})," \u2192 patch release"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"refactor!: ..."})," or body includes ",(0,l.jsx)(n.code,{children:"BREAKING CHANGE:"})," \u2192 major release"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Optional: add a changeset manually with ",(0,l.jsx)(n.code,{children:"pnpm version:gen"})," if you want custom\nnotes or multi-package details. If you don\u2019t, the bot will generate one for\nyou based on the PR title."]}),"\n",(0,l.jsxs)(n.li,{children:["If you want prerelease streams:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Trigger pre-mode with the workflow \u201cChangesets Pre-Mode Toggle\u201d (Actions \u2192\nRun workflow) and choose ",(0,l.jsx)(n.code,{children:"enter"})," + channel (",(0,l.jsx)(n.code,{children:"beta"}),", ",(0,l.jsx)(n.code,{children:"rc"}),", or ",(0,l.jsx)(n.code,{children:"next"}),")."]}),"\n",(0,l.jsxs)(n.li,{children:["To exit pre-mode, run the same workflow with ",(0,l.jsx)(n.code,{children:"exit"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"That\u2019s it. No tagging or manual publishes."}),"\n",(0,l.jsx)(n.h2,{id:"what-the-automation-does",children:"What the automation does"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["On PRs to main:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Ensures a changeset exists. If missing, it creates ",(0,l.jsx)(n.code,{children:".changeset/*.md"})," using\nthe PR title to determine semver bump."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["On push to main:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Changesets Manage & Publish"})," opens/updates the ",(0,l.jsx)(n.strong,{children:"Version Packages"})," PR or\n(when that PR merges) publishes to npm with ",(0,l.jsx)(n.code,{children:"pnpm release"})," and creates the\ntag."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Nightly at 02:00 UTC (only when pre-mode is active):","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Alpha Snapshot Release"})," publishes ",(0,l.jsx)(n.code,{children:"-alpha-YYYYMMDDHHMMSS"})," snapshots to the\n",(0,l.jsx)(n.code,{children:"alpha"})," npm dist-tag. If pre-mode is off, this job skips to avoid confusion\nwith stable releases."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["On new tags ",(0,l.jsx)(n.code,{children:"v*.*.*"}),":","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Tag Assets"})," builds, generates an SBOM, and creates a GitHub Release with\nnotes."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Version Packages PR auto-merge:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Auto-merge Version Packages PR"})," enables auto-merge (squash). It merges\nafter required checks pass (no human approval needed)."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"labels-commands-and-signals",children:"Labels, commands, and signals"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Pre-mode toggle is done via the ",(0,l.jsx)(n.code,{children:"Changesets Pre-Mode Toggle"})," workflow inputs;\nno special labels are required."]}),"\n",(0,l.jsxs)(n.li,{children:["You may optionally add a label ",(0,l.jsx)(n.code,{children:"release:pre-toggle"})," to organize those PRs."]}),"\n",(0,l.jsx)(n.li,{children:"For strict beta cadence, you can schedule pre-mode entry/exit using\nrepository-level scheduled workflows."}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"required-checks-branch-protection",children:"Required checks (branch protection)"}),"\n",(0,l.jsx)(n.p,{children:"Ensure these checks are required before merging:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"PR quality"})," (workflow conclusion) or its job-level checks: ",(0,l.jsx)(n.code,{children:"Lint"}),",\n",(0,l.jsx)(n.code,{children:"Typecheck"}),", ",(0,l.jsx)(n.code,{children:"Tests + Coverage"}),", ",(0,l.jsx)(n.code,{children:"Repo quality checks"})]}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"Commitlint"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"PR Title Lint"})}),"\n",(0,l.jsxs)(n.li,{children:["Optionally enforce: ",(0,l.jsx)(n.code,{children:"Dependency Review"}),", ",(0,l.jsx)(n.code,{children:"CodeQL"})]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"notes-for-ai-agents",children:"Notes for AI agents"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["If a PR is missing a changeset, create one using the same logic as the\n",(0,l.jsx)(n.code,{children:"Auto-generate Changeset (PR)"})," workflow, and push it to the PR branch."]}),"\n",(0,l.jsxs)(n.li,{children:["To start a beta/rc stream, dispatch ",(0,l.jsx)(n.code,{children:"Changesets Pre-Mode Toggle"})," with\n",(0,l.jsx)(n.code,{children:"enter"})," + ",(0,l.jsx)(n.code,{children:"beta"}),"/",(0,l.jsx)(n.code,{children:"rc"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["To end the stream, dispatch the same with ",(0,l.jsx)(n.code,{children:"exit"}),"."]}),"\n",(0,l.jsx)(n.li,{children:"Alpha snapshots should only be produced while pre-mode is active; otherwise,\nskip snapshot behavior."}),"\n",(0,l.jsx)(n.li,{children:"Avoid pushing tags manually; tags are created by the publish step."}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Version PR won\u2019t merge: open the PR checks and ensure all required checks are\ngreen. If auto-merge wasn\u2019t enabled, the auto-merge workflow may have missed\nthe event\u2014re-run the workflow or enable auto-merge manually in the PR UI."}),"\n",(0,l.jsxs)(n.li,{children:["Publish failed:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Verify ",(0,l.jsx)(n.code,{children:"NPM_TOKEN"})," is present and has publish scope to the\n",(0,l.jsx)(n.code,{children:"chatline"})," package."]}),"\n",(0,l.jsxs)(n.li,{children:["Ensure ",(0,l.jsx)(n.code,{children:"id-token: write"})," permissions are enabled where provenance is\nrequired."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Alpha snapshots not appearing: check the cron logs for\n",(0,l.jsx)(n.code,{children:"Alpha Snapshot Release"}),"."]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"reference-scripts-packagejson",children:"Reference scripts (package.json)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"release"}),": ",(0,l.jsx)(n.code,{children:"changeset publish"})," (used by publish workflows)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"release:snapshot:canary"}),":\n",(0,l.jsx)(n.code,{children:"changeset version --snapshot canary && changeset publish --tag canary"})," \u26a0\ufe0f\n",(0,l.jsx)(n.strong,{children:"Only works when NOT in pre-mode"})," (",(0,l.jsx)(n.code,{children:".changeset/pre.json"})," must not exist)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"version:pre"}),": ",(0,l.jsx)(n.code,{children:"changeset version"})," (not used directly; handled by action)"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.p,{children:"Last updated: 2025-11-12."})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}}}]);