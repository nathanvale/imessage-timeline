"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[3144],{3322:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"imessage-pipeline-troubleshooting","title":"iMessage Pipeline Troubleshooting Guide","description":"Version 2025-10-19 Project: iMessage Timeline","source":"@site/docs/imessage-pipeline-troubleshooting.md","sourceDirName":".","slug":"/imessage-pipeline-troubleshooting","permalink":"/chatline/docs/imessage-pipeline-troubleshooting","draft":false,"unlisted":false,"editUrl":"https://github.com/nathanvale/chatline/tree/main/website/docs/imessage-pipeline-troubleshooting.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"iMessage pipeline \u2014 technical specification","permalink":"/chatline/docs/imessage-pipeline-tech-spec"},"next":{"title":"iMessage Pipeline Usage Guide","permalink":"/chatline/docs/imessage-pipeline-usage"}}');var r=s(6801),l=s(5705);const a={},t="iMessage Pipeline Troubleshooting Guide",o={},c=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Date and Timezone Issues",id:"date-and-timezone-issues",level:2},{value:"Problem: &quot;Date must end with Z suffix (UTC)&quot;",id:"problem-date-must-end-with-z-suffix-utc",level:3},{value:"Problem: Apple Epoch Conversion Errors",id:"problem-apple-epoch-conversion-errors",level:3},{value:"Problem: DST Boundaries Cause Duplicate/Missing Messages",id:"problem-dst-boundaries-cause-duplicatemissing-messages",level:3},{value:"Problem: Leap Second Handling",id:"problem-leap-second-handling",level:3},{value:"Missing Media Files",id:"missing-media-files",level:2},{value:"Problem: &quot;Attachment not found at path&quot;",id:"problem-attachment-not-found-at-path",level:3},{value:"Problem: HEIC/TIFF Conversion Fails",id:"problem-heictiff-conversion-fails",level:3},{value:"Problem: Absolute vs Relative Paths",id:"problem-absolute-vs-relative-paths",level:3},{value:"Rate Limiting and API Errors",id:"rate-limiting-and-api-errors",level:2},{value:"Problem: 429 Too Many Requests (Gemini API)",id:"problem-429-too-many-requests-gemini-api",level:3},{value:"Problem: Exponential Backoff Not Working",id:"problem-exponential-backoff-not-working",level:3},{value:"Problem: Circuit Breaker Triggered",id:"problem-circuit-breaker-triggered",level:3},{value:"Problem: Firecrawl 503 Service Unavailable",id:"problem-firecrawl-503-service-unavailable",level:3},{value:"Checkpoint and Resume Failures",id:"checkpoint-and-resume-failures",level:2},{value:"Problem: &quot;Config hash mismatch&quot;",id:"problem-config-hash-mismatch",level:3},{value:"Problem: Checkpoint File Corrupted",id:"problem-checkpoint-file-corrupted",level:3},{value:"Problem: Resume Skips Messages",id:"problem-resume-skips-messages",level:3},{value:"Problem: Checkpoint Writes Too Frequently",id:"problem-checkpoint-writes-too-frequently",level:3},{value:"Validation Errors",id:"validation-errors",level:2},{value:"Problem: &quot;messageKind=&#39;media&#39; but media field missing&quot;",id:"problem-messagekindmedia-but-media-field-missing",level:3},{value:"Problem: &quot;Invalid GUID format&quot;",id:"problem-invalid-guid-format",level:3},{value:"Problem: &quot;Enrichment kind already exists&quot;",id:"problem-enrichment-kind-already-exists",level:3},{value:"Problem: camelCase vs snake_case Field Names",id:"problem-camelcase-vs-snake_case-field-names",level:3},{value:"Performance Issues",id:"performance-issues",level:2},{value:"Problem: Enrichment Takes Too Long",id:"problem-enrichment-takes-too-long",level:3},{value:"Problem: High Memory Usage",id:"problem-high-memory-usage",level:3},{value:"Common Error Messages",id:"common-error-messages",level:2},{value:"Error: &quot;EACCES: permission denied&quot;",id:"error-eacces-permission-denied",level:3},{value:"Error: &quot;Cannot find module &#39;sharp&#39;&quot;",id:"error-cannot-find-module-sharp",level:3},{value:"Error: &quot;Invalid API key&quot;",id:"error-invalid-api-key",level:3},{value:"Error: &quot;No messages found in input&quot;",id:"error-no-messages-found-in-input",level:3},{value:"Getting Help",id:"getting-help",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"imessage-pipeline-troubleshooting-guide",children:"iMessage Pipeline Troubleshooting Guide"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Version"}),": 1.0 ",(0,r.jsx)(n.strong,{children:"Last Updated"}),": 2025-10-19 ",(0,r.jsx)(n.strong,{children:"Project"}),": iMessage Timeline\nRefactor"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#date-and-timezone-issues",children:"Date and Timezone Issues"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#missing-media-files",children:"Missing Media Files"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#rate-limiting-and-api-errors",children:"Rate Limiting and API Errors"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#checkpoint-and-resume-failures",children:"Checkpoint and Resume Failures"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#validation-errors",children:"Validation Errors"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#performance-issues",children:"Performance Issues"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#common-error-messages",children:"Common Error Messages"})}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"date-and-timezone-issues",children:"Date and Timezone Issues"}),"\n",(0,r.jsx)(n.h3,{id:"problem-date-must-end-with-z-suffix-utc",children:'Problem: "Date must end with Z suffix (UTC)"'}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": Validation fails with error about missing Z suffix."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u274c Validation failed:\n  - date: Date must end with Z suffix (UTC)\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": Non-UTC timezone in CSV data or manual edits."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check the problematic message in JSON\njq '.messages[] | select(.date | endswith(\"Z\") | not)' normalized.json\n\n# Convert dates to UTC during ingest\nchatline ingest-csv \\\n  --input messages.csv \\\n  --output ingested.json \\\n  --force-utc\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Prevention"}),": Always use UTC dates. The pipeline enforces ISO 8601 with Z\nsuffix."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"problem-apple-epoch-conversion-errors",children:"Problem: Apple Epoch Conversion Errors"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": Dates appear as year 1970 or 2159."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Date: 1970-01-01T00:00:00.000Z (should be 2024)\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"1970"}),": Treating Apple epoch as Unix epoch"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"2159"}),": Apple epoch seconds interpreted as milliseconds"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Apple Epoch Details"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Apple epoch: Seconds since ",(0,r.jsx)(n.code,{children:"2001-01-01 00:00:00 UTC"})]}),"\n",(0,r.jsxs)(n.li,{children:["Valid range: ",(0,r.jsx)(n.code,{children:"0"})," to ",(0,r.jsx)(n.code,{children:"~5,000,000,000"})," (year 2159)"]}),"\n",(0,r.jsxs)(n.li,{children:["Example: ",(0,r.jsx)(n.code,{children:"756,864,000"})," = ",(0,r.jsx)(n.code,{children:"2024-12-31 00:00:00 UTC"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// \u2705 Correct: Add APPLE_EPOCH_SECONDS before converting\nconst APPLE_EPOCH_SECONDS = 978_307_200\nconst unixMs = (appleEpochSeconds + APPLE_EPOCH_SECONDS) * 1000\nconst date = new Date(unixMs).toISOString()\n\n// \u274c Wrong: Treating as Unix timestamp\nconst date = new Date(appleEpochSeconds * 1000).toISOString()\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Verification"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Check date ranges in output\njq \'.messages | map(.date) | unique | sort | .[0], .[-1]\' normalized.json\n\n# Should show reasonable date range:\n# "2024-01-01T00:00:00.000Z"\n# "2024-12-31T23:59:59.000Z"\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"problem-dst-boundaries-cause-duplicatemissing-messages",children:"Problem: DST Boundaries Cause Duplicate/Missing Messages"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": Messages near DST transitions appear duplicated or missing."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"DST Transition Times"})," (varies by region):"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"US"}),": March 2am \u2192 3am (spring), November 2am \u2192 1am (fall)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Australia"}),": October 2am \u2192 3am (spring), April 3am \u2192 2am (fall)"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example Problem"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"2024-03-10T02:30:00Z (doesn't exist during spring DST)\n2024-11-03T01:30:00Z (exists twice during fall DST)\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": The pipeline uses ",(0,r.jsx)(n.strong,{children:"UTC everywhere"})," to avoid DST issues."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Verify all dates are UTC\njq '.messages[].date | select(endswith(\"Z\") | not)' normalized.json\n\n# Should return no results (empty output)\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"If CSV has local times"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Convert during ingest with timezone offset\nchatline ingest-csv \\\n  --input messages.csv \\\n  --output ingested.json \\\n  --source-timezone "America/New_York"\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"problem-leap-second-handling",children:"Problem: Leap Second Handling"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": Validation fails near leap second timestamps."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u274c Invalid date: 2024-12-31T23:59:60.000Z\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": Leap seconds (",(0,r.jsx)(n.code,{children:"23:59:60"}),") are valid in UTC but not in ISO 8601."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Normalize to ",(0,r.jsx)(n.code,{children:"23:59:59.000Z"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// The pipeline handles this automatically in date-converters.ts\nexport function normalizeLeapSecond(dateString: string): string {\n  return dateString.replace(/T23:59:60/, 'T23:59:59')\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Verification"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Check for leap second timestamps\ngrep -r "23:59:60" normalized.json\n\n# Should be normalized to 23:59:59\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"missing-media-files",children:"Missing Media Files"}),"\n",(0,r.jsx)(n.h3,{id:"problem-attachment-not-found-at-path",children:'Problem: "Attachment not found at path"'}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": Media messages missing files."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u26a0 Missing files: 142/845\n  - /Users/you/Library/Messages/Attachments/aa/10/IMG_1234.heic\n  - /Users/you/Library/Messages/Attachments/bb/20/audio.m4a\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Common Causes"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Attachments deleted from disk"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Wrong attachment root directory"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Relative paths in CSV export"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"External storage not mounted"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution 1: Configure Multiple Attachment Roots"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"chatline ingest-csv \\\n  --input messages.csv \\\n  --output ingested.json \\\n  --attachment-roots \\\n    ~/Library/Messages/Attachments \\\n    /Volumes/Backup/old-messages/Attachments \\\n    /Volumes/External/iMessage-Archive\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution 2: Check Missing Files Report"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Generate detailed missing files report\njq \'.messages[] | select(.messageKind == "media" and .media.path == null) | {\n  guid: .guid,\n  filename: .media.filename,\n  originalPath: .metadata.originalPath\n}\' ingested.json > missing-files.json\n\n# Count missing by type\njq \'group_by(.filename | split(".") | .[-1]) | map({\n  extension: .[0].filename | split(".") | .[-1],\n  count: length\n})\' missing-files.json\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution 3: Locate Files Manually"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# find-missing-attachments.sh\n\n# Read missing files from report\njq -r \'.[].filename\' missing-files.json | while read filename; do\n  echo "Searching for $filename..."\n\n  # Search common locations\n  find ~/Library/Messages/Attachments -name "$filename" 2>/dev/null\n  find ~/Desktop -name "$filename" 2>/dev/null\n  find /Volumes -name "$filename" 2>/dev/null\ndone\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution 4: Skip Missing Files"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Continue pipeline with provenance metadata for missing files\nchatline normalize-link \\\n  --input ingested.json \\\n  --output normalized.json \\\n  --keep-missing-files \\\n  --verbose\n\n# Missing files will have:\n# media.path = null\n# metadata.lastSeenPath = "/original/path/IMG_1234.heic"\n# metadata.fileStatus = "missing"\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"problem-heictiff-conversion-fails",children:"Problem: HEIC/TIFF Conversion Fails"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": Preview generation errors during enrichment."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u274c Failed to convert HEIC to JPG: IMG_5678.heic\n   Error: sharp: Input buffer contains unsupported image format\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Corrupted HEIC files"}),"\n",(0,r.jsx)(n.li,{children:"Unsupported HEIC variant (e.g., multi-image sequences)"}),"\n",(0,r.jsx)(n.li,{children:"Missing libheif codec"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution 1: Verify Sharp Installation"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Reinstall sharp with native dependencies\npnpm remove sharp\npnpm add sharp --force\n\n# Verify codec support\nnode -e \"require('sharp')().metadata().then(console.log)\"\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution 2: Convert Manually"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Use macOS sips command\nsips -s format jpeg IMG_5678.heic --out IMG_5678.jpg\n\n# Or ImageMagick\nconvert IMG_5678.heic IMG_5678.jpg\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution 3: Skip Failed Conversions"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"chatline enrich-ai \\\n  --input normalized.json \\\n  --output enriched.json \\\n  --skip-failed-conversions \\\n  --log-conversion-errors ./conversion-errors.json\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"problem-absolute-vs-relative-paths",children:"Problem: Absolute vs Relative Paths"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),': Enrichment fails with "ENOENT: no such file or directory".']}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u274c Error: ENOENT: no such file or directory, open 'Attachments/IMG_1234.heic'\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": CSV exports contain relative paths, not absolute paths."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": The pipeline enforces absolute paths:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Path validator converts relative \u2192 absolute\nchatline normalize-link \\\n  --input ingested.json \\\n  --output normalized.json \\\n  --attachment-roots ~/Library/Messages/Attachments\n\n# Verifies all paths are absolute\n# media.path = "/Users/you/Library/Messages/Attachments/aa/10/IMG_1234.heic"\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Manual verification"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Check for relative paths\njq \'.messages[] | select(.messageKind == "media") | select(.media.path | startswith("/") | not)\' normalized.json\n\n# Should return no results\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"rate-limiting-and-api-errors",children:"Rate Limiting and API Errors"}),"\n",(0,r.jsx)(n.h3,{id:"problem-429-too-many-requests-gemini-api",children:"Problem: 429 Too Many Requests (Gemini API)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": Enrichment stops with rate limit errors."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u274c Gemini API Error: 429 Too Many Requests\n   Retry-After: 60 seconds\n   Message: \"Quota exceeded for quota metric 'Generate Content API requests per minute'\"\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": Exceeded Gemini free tier limits (15 RPM)."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution 1: Increase Delay"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Increase delay between requests to 4000ms (15 req/min)\nchatline enrich-ai \\\n  --input normalized.json \\\n  --output enriched.json \\\n  --rate-limit 4000\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution 2: Upgrade API Tier"})}),"\n",(0,r.jsx)(n.p,{children:"Free tier limits:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"15 RPM"})," (requests per minute)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"1500 RPD"})," (requests per day)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"1 million TPM"})," (tokens per minute)"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Upgrade to paid tier:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Visit ",(0,r.jsx)(n.a,{href:"https://aistudio.google.com/app/apikey",children:"Google AI Studio"})]}),"\n",(0,r.jsx)(n.li,{children:"Enable billing"}),"\n",(0,r.jsxs)(n.li,{children:["Increase to ",(0,r.jsx)(n.strong,{children:"60 RPM"})," or ",(0,r.jsx)(n.strong,{children:"360 RPM"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution 3: Use Checkpoints"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Let pipeline auto-resume after rate limit resets\nchatline enrich-ai \\\n  --input normalized.json \\\n  --output enriched.json \\\n  --checkpoint-interval 50 \\\n  --resume \\\n  --max-retries 5\n"})}),"\n",(0,r.jsx)(n.p,{children:"The pipeline will:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Hit 429 error"}),"\n",(0,r.jsxs)(n.li,{children:["Wait for ",(0,r.jsx)(n.code,{children:"Retry-After"})," header duration (or exponential backoff)"]}),"\n",(0,r.jsx)(n.li,{children:"Write checkpoint"}),"\n",(0,r.jsx)(n.li,{children:"Retry automatically"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"problem-exponential-backoff-not-working",children:"Problem: Exponential Backoff Not Working"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": Pipeline retries too quickly after 429 errors."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u274c Retry attempt 1/3 after 2s...\n\u274c Retry attempt 2/3 after 4s...\n\u274c Retry attempt 3/3 after 8s...\n\u274c Max retries exceeded\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": Exponential backoff formula:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Delay = 2^attempt seconds with \xb125% jitter\nconst baseDelay = Math.pow(2, attemptNumber) * 1000 // ms\nconst jitter = baseDelay * 0.25 * (Math.random() * 2 - 1)\nconst delay = baseDelay + jitter\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Respect ",(0,r.jsx)(n.code,{children:"Retry-After"})," header:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# The pipeline automatically detects Retry-After\n# Check rate-limiting.ts logs:\n\n\u2713 429 response received\n\u2192 Retry-After header: 60 seconds\n\u2192 Waiting 60000ms before retry...\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Manual override"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'// In your config\n{\n  "gemini": {\n    "rateLimitDelay": 2000,\n    "maxRetries": 5,\n    "backoffMultiplier": 3 // 3^n instead of 2^n\n  }\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"problem-circuit-breaker-triggered",children:"Problem: Circuit Breaker Triggered"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": Pipeline stops after consecutive failures."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u274c Circuit breaker OPEN after 5 consecutive failures\n\u23f8  Halting enrichment to prevent cascading failures\n   Wait 60s for circuit to reset, then resume with --resume\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": Circuit breaker prevents hammering failing APIs."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Default thresholds"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"5 consecutive failures"})," \u2192 circuit opens"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"60 seconds"})," \u2192 circuit resets (half-open state)"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution 1: Wait for Reset"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Wait 60 seconds, then resume\nsleep 60\nchatline enrich-ai \\\n  --input normalized.json \\\n  --output enriched.json \\\n  --resume\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution 2: Adjust Threshold"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Increase threshold to 10 failures\nchatline enrich-ai \\\n  --input normalized.json \\\n  --output enriched.json \\\n  --circuit-breaker-threshold 10 \\\n  --circuit-breaker-reset-ms 120000\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution 3: Check API Status"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Verify Gemini API is operational\ncurl -H "Authorization: Bearer $GEMINI_API_KEY" \\\n  https://generativelanguage.googleapis.com/v1beta/models\n\n# Check status page\nopen https://status.cloud.google.com/\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"problem-firecrawl-503-service-unavailable",children:"Problem: Firecrawl 503 Service Unavailable"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": Link enrichment fails intermittently."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u26a0 Firecrawl error: 503 Service Unavailable\n\u2192 Falling back to provider-specific parser (YouTube)\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": The pipeline has automatic fallbacks:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Firecrawl (primary)\n  \u2193 (fails)\nYouTube Parser (if youtube.com URL)\n  \u2193 (fails)\nSpotify Parser (if spotify.com URL)\n  \u2193 (fails)\nTwitter Parser (if twitter.com/x.com URL)\n  \u2193 (fails)\nInstagram Parser (if instagram.com URL)\n  \u2193 (fails)\nGeneric meta tag parser\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Disable Firecrawl"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Skip Firecrawl, use fallbacks only\nchatline enrich-ai \\\n  --input normalized.json \\\n  --output enriched.json \\\n  --enable-firecrawl false\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"checkpoint-and-resume-failures",children:"Checkpoint and Resume Failures"}),"\n",(0,r.jsx)(n.h3,{id:"problem-config-hash-mismatch",children:'Problem: "Config hash mismatch"'}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": Resume fails due to configuration change."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u274c Cannot resume: Config hash mismatch\n   Checkpoint: a3b5c8d0e2f4a6b8\n   Current:    f9e1c3b7d5a9c1e3\n\n   Configuration has changed since checkpoint was created.\n   Delete checkpoint and restart, or restore original config.\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": Configuration changed between runs (e.g., different API key, rate\nlimit settings)."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Config hash includes"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"geminiApiKey"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"firecrawlApiKey"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"rateLimitDelay"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"enableVisionAnalysis"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"enableAudioTranscription"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"enableLinkEnrichment"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"imageCacheDir"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution 1: Delete Checkpoint"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Remove checkpoint and start fresh\nrm -f checkpoints/enrich-checkpoint-*.json\nchatline enrich-ai \\\n  --input normalized.json \\\n  --output enriched.json\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution 2: Restore Original Config"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Find original config hash in checkpoint\njq '.configHash, .createdAt' checkpoints/enrich-checkpoint-500.json\n\n# Restore config to match checkpoint\n# (e.g., restore .env, imessage-config.json)\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution 3: Force Resume (DANGEROUS)"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Override hash check (may cause inconsistent enrichments)\nchatline enrich-ai \\\n  --input normalized.json \\\n  --output enriched.json \\\n  --resume \\\n  --force-resume-ignore-config\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,r.jsx)(n.strong,{children:"Warning"}),": Force resuming with different config may cause:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Duplicate enrichments with different models"}),"\n",(0,r.jsx)(n.li,{children:"Missing enrichments if providers disabled"}),"\n",(0,r.jsx)(n.li,{children:"Inconsistent rate limiting"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"problem-checkpoint-file-corrupted",children:"Problem: Checkpoint File Corrupted"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": Resume fails with parse error."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u274c Failed to load checkpoint: checkpoints/enrich-checkpoint-300.json\n   SyntaxError: Unexpected end of JSON input\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": Checkpoint write interrupted (Ctrl+C during write, disk full)."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution 1: Load Previous Checkpoint"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# List checkpoints\nls -lh checkpoints/enrich-checkpoint-*.json\n\n# Use earlier checkpoint\ncp checkpoints/enrich-checkpoint-200.json checkpoints/enrich-checkpoint-latest.json\nchatline enrich-ai \\\n  --input normalized.json \\\n  --output enriched.json \\\n  --resume\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution 2: Repair JSON"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check for truncation\ntail -c 50 checkpoints/enrich-checkpoint-300.json\n\n# Attempt repair with jq\njq '.' checkpoints/enrich-checkpoint-300.json\n\n# If repair fails, delete and use previous checkpoint\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution 3: Start from Scratch"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Remove all checkpoints\nrm -rf checkpoints/\nchatline enrich-ai \\\n  --input normalized.json \\\n  --output enriched.json \\\n  --checkpoint-interval 25 # More frequent checkpoints\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"problem-resume-skips-messages",children:"Problem: Resume Skips Messages"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": Resume starts at wrong index."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u2713 Loaded checkpoint: last index 500\n\u2192 Resuming from index 501\n\u26a0 But message 500 was not fully enriched!\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": Checkpoint written before enrichment completed."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Resume guarantee"}),": The pipeline resumes ",(0,r.jsx)(n.strong,{children:"within \u22641 item"})," of checkpoint."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Resume logic (checkpoint.ts)\nexport function getResumeIndex(checkpoint: EnrichCheckpoint): number {\n  // Resume at next item after last successfully processed\n  return checkpoint.lastProcessedIndex + 1\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Check failed items list:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Inspect checkpoint for failed items\njq \'.failedItems\' checkpoints/enrich-checkpoint-500.json\n\n# Example output:\n# [\n#   {\n#     "index": 245,\n#     "guid": "abc-123",\n#     "kind": "image_analysis",\n#     "error": "Gemini API timeout"\n#   }\n# ]\n\n# Re-enrich failed items manually\nchatline enrich-ai \\\n  --input normalized.json \\\n  --output enriched.json \\\n  --force-refresh \\\n  --only-guids abc-123,def-456\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"problem-checkpoint-writes-too-frequently",children:"Problem: Checkpoint Writes Too Frequently"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": Enrichment slow due to frequent checkpoint writes."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u2713 Checkpoint written: enrich-checkpoint-10.json (2.1 MB)\n\u2713 Checkpoint written: enrich-checkpoint-20.json (4.2 MB)\n\u2713 Checkpoint written: enrich-checkpoint-30.json (6.3 MB)\n...\n\u23f1  Total time: 3h 45m (expected 45m for 1000 messages)\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": Checkpoint interval too small (default 100)."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Increase interval:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Write checkpoint every 500 items instead of 100\nchatline enrich-ai \\\n  --input normalized.json \\\n  --output enriched.json \\\n  --checkpoint-interval 500\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Tradeoffs"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Smaller interval"})," (10-50): More frequent backups, slower performance"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Larger interval"})," (500-1000): Faster performance, lose more progress on\nfailure"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Recommended"}),": 100 items (default) balances speed and safety"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"validation-errors",children:"Validation Errors"}),"\n",(0,r.jsx)(n.h3,{id:"problem-messagekindmedia-but-media-field-missing",children:"Problem: \"messageKind='media' but media field missing\""}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": Schema validation fails."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u274c Validation failed: Message abc-123\n   - superRefine: messageKind='media' requires media field\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": CSV row classified as media but attachment path missing."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Check CSV row:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Find problematic message\njq \'.messages[] | select(.guid == "abc-123")\' ingested.json\n\n# Example:\n# {\n#   "guid": "abc-123",\n#   "messageKind": "media",  \u2190 Classified as media\n#   "media": null            \u2190 But media field is null!\n# }\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Fix"}),": Re-ingest with strict validation:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"chatline ingest-csv \\\n  --input messages.csv \\\n  --output ingested.json \\\n  --strict-media-validation \\\n  --log-invalid ./invalid-rows.json\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"problem-invalid-guid-format",children:'Problem: "Invalid GUID format"'}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": GUID validation fails."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'\u274c Validation error: guid must match pattern\n   guid: "invalid guid"\n   Expected: non-empty string\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": Malformed GUID in source data."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Valid GUID formats"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["CSV: ",(0,r.jsx)(n.code,{children:"csv:<rowNumber>:<partIndex>"})," (e.g., ",(0,r.jsx)(n.code,{children:"csv:123:0"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["DB: ",(0,r.jsx)(n.code,{children:"<UUID>"})," (e.g., ",(0,r.jsx)(n.code,{children:"550e8400-e29b-41d4-a716-446655440000"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Part: ",(0,r.jsx)(n.code,{children:"p:<index>/<parentGuid>"})," (e.g., ",(0,r.jsx)(n.code,{children:"p:1/abc-123"}),")"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Regenerate GUIDs:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Regenerate GUIDs during ingest\nchatline ingest-csv \\\n  --input messages.csv \\\n  --output ingested.json \\\n  --regenerate-guids\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"problem-enrichment-kind-already-exists",children:'Problem: "Enrichment kind already exists"'}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": Idempotency check prevents enrichment."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u23ed  Skipping image_analysis for media-456: already enriched\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": Re-running enrichment without ",(0,r.jsx)(n.code,{children:"--force-refresh"}),"."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution 1: Normal Behavior"})}),"\n",(0,r.jsxs)(n.p,{children:["This is ",(0,r.jsx)(n.strong,{children:"expected"})," behavior (idempotency). Re-running won't duplicate\nenrichments."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution 2: Force Re-enrichment"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Re-enrich all messages (overwrites existing)\nchatline enrich-ai \\\n  --input normalized.json \\\n  --output enriched.json \\\n  --force-refresh\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution 3: Clear Specific Enrichments"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Clear only image_analysis, keep others\nimport { clearEnrichmentByKind } from 'chatline'\n\nfor (const msg of messages) {\n  if (msg.messageKind === 'media') {\n    msg.media.enrichment = clearEnrichmentByKind(\n      msg.media.enrichment,\n      'image_analysis',\n    )\n  }\n}\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"problem-camelcase-vs-snake_case-field-names",children:"Problem: camelCase vs snake_case Field Names"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": Validation rejects snake_case fields."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u274c Validation error: Unexpected field 'message_date'\n   Use camelCase: 'messageDate'\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": CSV export uses snake_case (e.g., ",(0,r.jsx)(n.code,{children:"message_date"}),"), schema requires\ncamelCase."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": The ingest stage auto-converts:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// ingest-csv.ts mapping\nconst mapping = {\n  'Message Date': 'date', // CSV \u2192 camelCase\n  'Delivered Date': 'dateDelivered',\n  'Read Date': 'dateRead',\n  'Is From Me': 'isFromMe',\n  // ...\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Verify conversion"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check for snake_case fields\njq 'keys' ingested.json | grep \"_\"\n\n# Should return no results (all camelCase)\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"performance-issues",children:"Performance Issues"}),"\n",(0,r.jsx)(n.h3,{id:"problem-enrichment-takes-too-long",children:"Problem: Enrichment Takes Too Long"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": Processing 1000 messages takes >2 hours."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Expected performance"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Ingest CSV"}),": ~500 messages/second"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Normalize-Link"}),": ~1000 messages/second"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Enrich-AI"}),": ~2 messages/second (limited by API rate)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Render"}),": ~5000 messages/second"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solutions"}),":"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"1. Reduce Rate Limit Delay"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Default 1000ms \u2192 change to 500ms\nchatline enrich-ai \\\n  --rate-limit 500\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,r.jsx)(n.strong,{children:"Warning"}),": May trigger 429 errors if too aggressive."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"2. Skip Certain Enrichments"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Skip audio transcription (slow)\nchatline enrich-ai \\\n  --enable-audio false\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"3. Parallel Processing"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Split messages into batches\njq '.messages[0:500]' normalized.json > batch1.json\njq '.messages[500:1000]' normalized.json > batch2.json\n\n# Run in parallel\nchatline enrich-ai --input batch1.json --output enriched1.json &\nchatline enrich-ai --input batch2.json --output enriched2.json &\nwait\n\n# Merge results\njq -s '.[0].messages + .[1].messages | {messages: .}' enriched1.json enriched2.json > enriched.json\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"problem-high-memory-usage",children:"Problem: High Memory Usage"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": Node.js crashes with OOM (out of memory)."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"<--- Last few GCs ---\x3e\nFATAL ERROR: Reached heap limit Allocation failed - JavaScript heap out of memory\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": Loading entire message JSON into memory."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Increase Node heap size:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Increase to 4GB\nNODE_OPTIONS="--max-old-space-size=4096" \\\n  chatline enrich-ai \\\n  --input normalized.json \\\n  --output enriched.json\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Streaming mode"})," (future enhancement):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Process in chunks\nchatline enrich-ai \\\n  --input normalized.json \\\n  --output enriched.json \\\n  --streaming \\\n  --chunk-size 100\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"common-error-messages",children:"Common Error Messages"}),"\n",(0,r.jsx)(n.h3,{id:"error-eacces-permission-denied",children:'Error: "EACCES: permission denied"'}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u274c Error: EACCES: permission denied, open '/Users/you/Library/Messages/chat.db'\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Fix"}),": Grant Full Disk Access on macOS:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"System Preferences \u2192 Security & Privacy \u2192 Privacy"}),"\n",(0,r.jsx)(n.li,{children:"Full Disk Access \u2192 Add Terminal or your app"}),"\n",(0,r.jsx)(n.li,{children:"Restart Terminal"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"error-cannot-find-module-sharp",children:"Error: \"Cannot find module 'sharp'\""}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u274c Error: Cannot find module 'sharp'\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Fix"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pnpm install sharp --force\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"error-invalid-api-key",children:'Error: "Invalid API key"'}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u274c Gemini API Error: 401 Unauthorized\n   Invalid API key\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Fix"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Verify API key is set\necho $GEMINI_API_KEY\n\n# Re-export if needed\nexport GEMINI_API_KEY="AIzaSy..."\n\n# Or update .env\necho "GEMINI_API_KEY=AIzaSy..." >> .env\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"error-no-messages-found-in-input",children:'Error: "No messages found in input"'}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u274c Error: No messages found in input file\n   File: ingested.json\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Fix"}),": Check JSON structure:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Verify envelope format\njq '.messages | length' ingested.json\n\n# Should return number (e.g., 1234)\n# Not: null or error\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"getting-help",children:"Getting Help"}),"\n",(0,r.jsx)(n.p,{children:"If you encounter an error not covered here:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Enable verbose logging"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"chatline enrich-ai \\\n  --input normalized.json \\\n  --output enriched.json \\\n  --verbose \\\n  --log-file debug.log\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Check logs"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"tail -f debug.log\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"File an issue"})," with:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Error message (full stack trace)"}),"\n",(0,r.jsx)(n.li,{children:"Command run"}),"\n",(0,r.jsx)(n.li,{children:"Input file sample (first 10 messages)"}),"\n",(0,r.jsx)(n.li,{children:"Environment (Node version, OS, pnpm version)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"/chatline/docs/imessage-pipeline-usage",children:"Usage Guide"})})," - How to run the pipeline"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"/chatline/docs/imessage-pipeline-tech-spec",children:"Technical Specification"})})," - Architecture\ndetails"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"/chatline/docs/imessage-pipeline-implementation-summary",children:"Implementation Summary"})})," -\nFile structure"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Document Version"}),": 1.0 ",(0,r.jsx)(n.strong,{children:"Author"}),": Generated from iMessage Pipeline\nimplementation ",(0,r.jsx)(n.strong,{children:"Last Updated"}),": 2025-10-19"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},5705:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>t});var i=s(7701);const r={},l=i.createContext(r);function a(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);