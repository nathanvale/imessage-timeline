"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[2390],{5705:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>c});var i=s(7701);const r={},t=i.createContext(r);function o(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(t.Provider,{value:n},e.children)}},9164:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"ci-workflow-standards","title":"CI workflow standards","description":"This repository uses a few conventions to keep workflows secure, deterministic,","source":"@site/docs/ci-workflow-standards.md","sourceDirName":".","slug":"/ci-workflow-standards","permalink":"/imessage-timeline/docs/ci-workflow-standards","draft":false,"unlisted":false,"editUrl":"https://github.com/nathanvale/imessage-timeline/tree/main/website/docs/ci-workflow-standards.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"CI pnpm Caching Strategy","permalink":"/imessage-timeline/docs/ci-pnpm-caching"},"next":{"title":"config-best-practices-review","permalink":"/imessage-timeline/docs/config-best-practices-review"}}');var r=s(6801),t=s(5705);const o={},c="CI workflow standards",l={},d=[{value:"DRY setup via composite actions",id:"dry-setup-via-composite-actions",level:2},{value:"Permissions (least privilege)",id:"permissions-least-privilege",level:2},{value:"Concurrency groups",id:"concurrency-groups",level:2},{value:"Action pinning",id:"action-pinning",level:2},{value:"Artifacts and reports",id:"artifacts-and-reports",level:2},{value:"Reporting in CI",id:"reporting-in-ci",level:2},{value:"When to use reusable workflows",id:"when-to-use-reusable-workflows",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"ci-workflow-standards",children:"CI workflow standards"})}),"\n",(0,r.jsx)(n.p,{children:"This repository uses a few conventions to keep workflows secure, deterministic,\nand easy to maintain."}),"\n",(0,r.jsx)(n.h2,{id:"dry-setup-via-composite-actions",children:"DRY setup via composite actions"}),"\n",(0,r.jsx)(n.p,{children:"Use these composite actions instead of hand-rolled setup steps:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"- name: Standard CI Env\n  uses: ./.github/actions/standard-ci-env\n\n- name: Setup pnpm toolchain\n  uses: ./.github/actions/setup-pnpm\n  with:\n    # For publish flows\n    registry-url: 'https://registry.npmjs.org'\n"})}),"\n",(0,r.jsx)(n.p,{children:"Effects:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Exports ",(0,r.jsx)(n.code,{children:"TZ=UTC"})," and ",(0,r.jsx)(n.code,{children:"TF_BUILD=true"})]}),"\n",(0,r.jsxs)(n.li,{children:["Enables Corepack, pins pnpm via ",(0,r.jsx)(n.code,{children:"packageManager"})]}),"\n",(0,r.jsxs)(n.li,{children:["Sets Node version from ",(0,r.jsx)(n.code,{children:".nvmrc"})]}),"\n",(0,r.jsxs)(n.li,{children:["Configures and caches pnpm store keyed by ",(0,r.jsx)(n.code,{children:".nvmrc"})," + ",(0,r.jsx)(n.code,{children:"pnpm-lock.yaml"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"permissions-least-privilege",children:"Permissions (least privilege)"}),"\n",(0,r.jsx)(n.p,{children:"Prefer the minimum required:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Read-only by default: ",(0,r.jsx)(n.code,{children:"contents: read"})]}),"\n",(0,r.jsxs)(n.li,{children:["Write only when needed: ",(0,r.jsx)(n.code,{children:"contents: write"}),", ",(0,r.jsx)(n.code,{children:"pull-requests: write"}),",\n",(0,r.jsx)(n.code,{children:"id-token: write"})," (for npm provenance)"]}),"\n",(0,r.jsxs)(n.li,{children:["Add ",(0,r.jsx)(n.code,{children:"actions: read"})," where the workflow reads other workflows/actions"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"concurrency-groups",children:"Concurrency groups"}),"\n",(0,r.jsx)(n.p,{children:"Avoid duplicate runs by scoping groups:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["PR quality: ",(0,r.jsx)(n.code,{children:"${{ github.workflow }}-${{ github.ref }}"})]}),"\n",(0,r.jsxs)(n.li,{children:["Release: ",(0,r.jsx)(n.code,{children:"release-${{ github.ref }}"})]}),"\n",(0,r.jsxs)(n.li,{children:["Channel release:\n",(0,r.jsx)(n.code,{children:"${{ github.workflow }}-${{ github.ref }}-${{ inputs.channel }}"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Set ",(0,r.jsx)(n.code,{children:"cancel-in-progress: true"})," to auto-cancel superseded runs."]}),"\n",(0,r.jsx)(n.h2,{id:"action-pinning",children:"Action pinning"}),"\n",(0,r.jsx)(n.p,{children:"Pin all third-party actions to immutable commit SHAs to reduce supply-chain\nrisk. Refresh SHAs periodically (Dependabot can assist)."}),"\n",(0,r.jsx)(n.h2,{id:"artifacts-and-reports",children:"Artifacts and reports"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Test results (Vitest JUnit): ",(0,r.jsx)(n.code,{children:"./test-results/junit.xml"})]}),"\n",(0,r.jsxs)(n.li,{children:["Coverage artifacts (HTML, lcov, text-summary): ",(0,r.jsx)(n.code,{children:"./test-results/coverage/"})]}),"\n",(0,r.jsx)(n.li,{children:"Retention: 14\u201330 days depending on workflow importance"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"reporting-in-ci",children:"Reporting in CI"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Set ",(0,r.jsx)(n.code,{children:"TF_BUILD=true"})," to enable CI-specific reporters and seeds"]}),"\n",(0,r.jsxs)(n.li,{children:["Ensure ",(0,r.jsx)(n.code,{children:"TZ=UTC"})," for deterministic dates and snapshots"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"when-to-use-reusable-workflows",children:"When to use reusable workflows"}),"\n",(0,r.jsxs)(n.p,{children:["If multiple repos share the same patterns, extract these conventions into a\nreusable workflow (",(0,r.jsx)(n.code,{children:"workflow_call"}),") in a central repo. Within a single repo,\ncomposite actions are usually sufficient and simpler."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.p,{children:"Last updated: 2025-11-12."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}}}]);