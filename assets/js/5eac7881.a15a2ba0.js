"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[29],{5705:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>d});var s=i(7701);const l={},t=s.createContext(l);function c(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:c(e.components),s.createElement(t.Provider,{value:n},e.children)}},8525:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>r});const s=JSON.parse('{"id":"package-hygiene","title":"Package Hygiene & Metadata Quality","description":"This guide documents the metadata, packaging rules, and validation checks that","source":"@site/docs/package-hygiene.md","sourceDirName":".","slug":"/package-hygiene","permalink":"/imessage-timeline/docs/package-hygiene","draft":false,"unlisted":false,"editUrl":"https://github.com/nathanvale/imessage-timeline/tree/main/website/docs/package-hygiene.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"NPM Automation Token Setup Guide","permalink":"/imessage-timeline/docs/npm-automation-token-setup"},"next":{"title":"Pre-Mode Workflow Consolidation Plan","permalink":"/imessage-timeline/docs/pre-mode-consolidation-plan"}}');var l=i(6801),t=i(5705);const c={},d="Package Hygiene & Metadata Quality",a={},r=[{value:"Objectives",id:"objectives",level:2},{value:"package.json essentials",id:"packagejson-essentials",level:2},{value:"Validation tools",id:"validation-tools",level:2},{value:"Local usage",id:"local-usage",level:3},{value:"CI workflow",id:"ci-workflow",level:3},{value:"Checklist before publishing",id:"checklist-before-publishing",level:2},{value:"Tarball size and contents",id:"tarball-size-and-contents",level:2},{value:"Types guidance",id:"types-guidance",level:2},{value:"Security &amp; provenance",id:"security--provenance",level:2},{value:"References",id:"references",level:2},{value:"Future enhancements",id:"future-enhancements",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"package-hygiene--metadata-quality",children:"Package Hygiene & Metadata Quality"})}),"\n",(0,l.jsxs)(n.p,{children:["This guide documents the metadata, packaging rules, and validation checks that\nkeep ",(0,l.jsx)(n.code,{children:"imessage-timeline"})," high-quality, predictable, and easy to consume."]}),"\n",(0,l.jsx)(n.h2,{id:"objectives",children:"Objectives"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Accurate and complete metadata on npm (discoverability, support, funding)"}),"\n",(0,l.jsx)(n.li,{children:"Minimal, intentional publish surface (small tarball, no leaks)"}),"\n",(0,l.jsx)(n.li,{children:"Strong type metadata with validation"}),"\n",(0,l.jsx)(n.li,{children:"Automated checks in CI prior to releases"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"packagejson-essentials",children:"package.json essentials"}),"\n",(0,l.jsx)(n.p,{children:"We follow npm guidance for top-level metadata fields:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"name"}),", ",(0,l.jsx)(n.code,{children:"version"}),", ",(0,l.jsx)(n.code,{children:"description"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"repository"}),", ",(0,l.jsx)(n.code,{children:"bugs"}),", ",(0,l.jsx)(n.code,{children:"homepage"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"license"}),", ",(0,l.jsx)(n.code,{children:"author"}),", ",(0,l.jsx)(n.code,{children:"funding"})]}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"keywords"})}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"type: module"})," with ",(0,l.jsx)(n.code,{children:"exports"})," and ",(0,l.jsx)(n.code,{children:"types"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"bin"})," for CLI"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"engines"})," and ",(0,l.jsx)(n.code,{children:"publishConfig"})," (with provenance)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"files"})," whitelist and ",(0,l.jsx)(n.code,{children:"sideEffects: false"})]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Current config includes:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"exports"})," with ESM and ",(0,l.jsx)(n.code,{children:"types"})," for ",(0,l.jsx)(n.code,{children:"."})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"files"}),": only ",(0,l.jsx)(n.code,{children:"dist/**"}),", ",(0,l.jsx)(n.code,{children:"README.md"}),", ",(0,l.jsx)(n.code,{children:"LICENSE"}),", ",(0,l.jsx)(n.code,{children:"CHANGELOG.md"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"sideEffects: false"})," for better tree-shaking"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"publishConfig.provenance: true"})," for npm OIDC provenance"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"validation-tools",children:"Validation tools"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"publint: Lints publish configuration for cross-env compatibility"}),"\n",(0,l.jsx)(n.li,{children:"arethetypeswrong (attw): Validates type exports and TypeScript metadata"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"local-usage",children:"Local usage"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"pnpm build\npnpm hygiene       # runs publint + attw\npnpm pack:dry      # creates tarball in ./.pack and lists its contents\n"})}),"\n",(0,l.jsx)(n.h3,{id:"ci-workflow",children:"CI workflow"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:".github/workflows/package-hygiene.yml"})," runs on PRs and manual dispatch:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Harden-Runner (audit mode)"}),"\n",(0,l.jsx)(n.li,{children:"Install, build"}),"\n",(0,l.jsx)(n.li,{children:"publint + attw"}),"\n",(0,l.jsx)(n.li,{children:"pnpm pack with artifact upload"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"checklist-before-publishing",children:"Checklist before publishing"}),"\n",(0,l.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","All public entrypoints defined in ",(0,l.jsx)(n.code,{children:"exports"})]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,l.jsx)(n.code,{children:"types"})," points to generated ",(0,l.jsx)(n.code,{children:".d.ts"})," in ",(0,l.jsx)(n.code,{children:"dist"})]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,l.jsx)(n.code,{children:"files"})," whitelist contains only what consumers need"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,l.jsx)(n.code,{children:"README"}),", ",(0,l.jsx)(n.code,{children:"LICENSE"}),", ",(0,l.jsx)(n.code,{children:"CHANGELOG.md"})," included"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,l.jsx)(n.code,{children:"bin"})," points at built CLI with shebang"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,l.jsx)(n.code,{children:"engines.node"})," matches supported versions"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,l.jsx)(n.code,{children:"repository"}),", ",(0,l.jsx)(n.code,{children:"bugs"}),", ",(0,l.jsx)(n.code,{children:"homepage"}),", ",(0,l.jsx)(n.code,{children:"funding"})," set"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","publint passes"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","attw passes (no red flags)"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"tarball-size-and-contents",children:"Tarball size and contents"}),"\n",(0,l.jsxs)(n.p,{children:["We prefer small, predictable tarballs. Use ",(0,l.jsx)(n.code,{children:"pnpm pack:dry"})," to inspect the exact\ncontents. If extra files slip in, tighten ",(0,l.jsx)(n.code,{children:"files"})," or add ",(0,l.jsx)(n.code,{children:".npmignore"})," (subdirs\nonly)."]}),"\n",(0,l.jsx)(n.h2,{id:"types-guidance",children:"Types guidance"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Emit ",(0,l.jsx)(n.code,{children:".d.ts"})," files to ",(0,l.jsx)(n.code,{children:"dist"})," and reference via top-level ",(0,l.jsx)(n.code,{children:"types"})," and\n",(0,l.jsx)(n.code,{children:'exports["."].types'}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Validate with ",(0,l.jsx)(n.code,{children:"attw --pack"})," to simulate the published tarball\u2019s types."]}),"\n",(0,l.jsxs)(n.li,{children:["Avoid unnecessary ",(0,l.jsx)(n.code,{children:"typesVersions"})," unless targeting older TS versions."]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"security--provenance",children:"Security & provenance"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Stable release workflow generates SBOM and publishes with OIDC provenance."}),"\n",(0,l.jsxs)(n.li,{children:["See ",(0,l.jsx)(n.code,{children:"docs/security-supply-chain.md"})," for details and controls."]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"npm package.json docs (description, repository, bugs, homepage, files,\nexports)"}),"\n",(0,l.jsx)(n.li,{children:"publint (publint.dev)"}),"\n",(0,l.jsx)(n.li,{children:"AreTheTypesWrong (arethetypeswrong.github.io)"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"future-enhancements",children:"Future enhancements"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"SBOM parity in hygiene workflow (optional) to mirror stable release scans"}),"\n",(0,l.jsx)(n.li,{children:"Tarball size gating: compute size and fail if exceeding a budget (e.g., 500\nKB)"}),"\n",(0,l.jsx)(n.li,{children:"License scanning against an allowlist using the generated SBOM"}),"\n",(0,l.jsx)(n.li,{children:"Strict publint settings once baseline is green; treat as blocking in CI"}),"\n",(0,l.jsx)(n.li,{children:"Types quality: add a type test project to assert public API types compile"}),"\n",(0,l.jsx)(n.li,{children:"OpenSSF Scorecard check for repository hygiene signals"}),"\n",(0,l.jsxs)(n.li,{children:["Log strategy: Use ",(0,l.jsx)(n.code,{children:"logs/"})," (or hidden ",(0,l.jsx)(n.code,{children:".logs/"})," for local-only dev traces)\nignored via ",(0,l.jsx)(n.code,{children:".gitignore"}),"; prefer structured rotating files (e.g.\n",(0,l.jsx)(n.code,{children:"pipeline-YYYYMMDD.log"}),"). Avoid committing transient logs\u2014commit only curated\naudit data when explicitly needed."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}}}]);