"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[9824],{5562:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"bun-single-repo-best-practices","title":"bun-single-repo-best-practices","description":"Bun single\u2011repo best practices (testing, linting, releases)","source":"@site/docs/bun-single-repo-best-practices.md","sourceDirName":".","slug":"/bun-single-repo-best-practices","permalink":"/chatline/docs/bun-single-repo-best-practices","draft":false,"unlisted":false,"editUrl":"https://github.com/nathanvale/chatline/tree/main/website/docs/bun-single-repo-best-practices.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Bun script best practices (CLI-focused)","permalink":"/chatline/docs/bun-script-best-practices"},"next":{"title":"CI pnpm Caching Strategy","permalink":"/chatline/docs/ci-pnpm-caching"}}');var t=s(6801),r=s(5705);const l={},d=void 0,c={},a=[{value:"Bun single\u2011repo best practices (testing, linting, releases)",id:"bun-singlerepo-best-practices-testing-linting-releases",level:2},{value:"TL;DR viability",id:"tldr-viability",level:3},{value:"Compatibility snapshot",id:"compatibility-snapshot",level:3},{value:"Recommended strategies",id:"recommended-strategies",level:3},{value:"Best practices checklist for a Bun\u2011first repo",id:"best-practices-checklist-for-a-bunfirst-repo",level:3},{value:"Suggested scripts (non\u2011breaking)",id:"suggested-scripts-nonbreaking",level:3},{value:"Migration plan (if you decide to adopt Bun more deeply)",id:"migration-plan-if-you-decide-to-adopt-bun-more-deeply",level:3},{value:"Decision guidance",id:"decision-guidance",level:3},{value:"What stays the same",id:"what-stays-the-same",level:3},{value:"Action items",id:"action-items",level:3}];function o(e){const n={code:"code",h2:"h2",h3:"h3",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"bun-singlerepo-best-practices-testing-linting-releases",children:"Bun single\u2011repo best practices (testing, linting, releases)"}),"\n",(0,t.jsx)(n.p,{children:"Date: 2025\u201111\u201111"}),"\n",(0,t.jsx)(n.p,{children:"This note evaluates moving the repository to \u201cBun for everything,\u201d including the\ntest runner, and outlines practical options with current dependencies (sharp,\nbetter\u2011sqlite3, Firecrawl SDK), Vitest, ESLint, Prettier, and Changesets."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"tldr-viability",children:"TL;DR viability"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Fully Bun\u2011only is possible, but has caveats around native addons and test\nrunner feature parity. A hybrid approach is safest now:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Keep pnpm for dependency management and Changesets publishing."}),"\n",(0,t.jsx)(n.li,{children:"Keep Vitest for tests (coverage, jsdom, reporters) on Node."}),"\n",(0,t.jsx)(n.li,{children:"Adopt Bun for local CLI runtime and scripts where it brings speed."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"If you still want \u201cBun for tests,\u201d run an experiment branch and validate the\nitems below before switching CI defaults."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"compatibility-snapshot",children:"Compatibility snapshot"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Area"}),(0,t.jsx)(n.th,{children:"Status with Bun"}),(0,t.jsx)(n.th,{children:"Notes"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"TypeScript compile"}),(0,t.jsx)(n.td,{children:"\u2705"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"moduleResolution: bundler"})," works well"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"CLI runtime"}),(0,t.jsx)(n.td,{children:"\u2705"}),(0,t.jsx)(n.td,{children:"Pure ESM is fine in Bun"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"sharp"}),(0,t.jsx)(n.td,{children:"\u26a0\ufe0f"}),(0,t.jsx)(n.td,{children:"Native addon; may compile from source; ensure libvips present"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"better\u2011sqlite3"}),(0,t.jsx)(n.td,{children:"\u26a0\ufe0f"}),(0,t.jsx)(n.td,{children:"Native addon; prebuilds may not include Bun; may compile"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Firecrawl SDK"}),(0,t.jsx)(n.td,{children:"\u2705"}),(0,t.jsx)(n.td,{children:"Uses fetch/HTTP; should work under Bun runtime"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"MCP Firecrawl server"}),(0,t.jsx)(n.td,{children:"\u2705 Node"}),(0,t.jsxs)(n.td,{children:["Stays Node\u2011driven via ",(0,t.jsx)(n.code,{children:"npx firecrawl-mcp"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Vitest on Node"}),(0,t.jsx)(n.td,{children:"\u2705"}),(0,t.jsx)(n.td,{children:"Current setup is robust (jsdom, coverage, CI reporters)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Vitest on Bun"}),(0,t.jsx)(n.td,{children:"\u26a0\ufe0f experimental"}),(0,t.jsx)(n.td,{children:"Some features may differ; confirm threads, coverage, jsdom"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"bun test"}),(0,t.jsx)(n.td,{children:"\u26a0\ufe0f gaps"}),(0,t.jsx)(n.td,{children:"Lacks some Vitest niceties (coverage/reporters parity, plugins)"})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"Key risk: native addons (sharp, better\u2011sqlite3). Expect CI toolchain to build\nfrom source or pin versions with Bun\u2011compatible prebuilds."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"recommended-strategies",children:"Recommended strategies"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Conservative hybrid (recommended for CI)"}),"\n"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Keep current stack for tests (Vitest on Node). Retains jsdom setup, coverage\nthresholds, junit/html reports, and threads pool tuning."}),"\n",(0,t.jsxs)(n.li,{children:["Add optional Bun scripts for local speed where safe:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"bun run dist/cli.js"})," or ",(0,t.jsx)(n.code,{children:"bun run src"})," workflows during dev."]}),"\n",(0,t.jsx)(n.li,{children:"Use Bun to execute small tooling scripts that are pure JS/TS."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:"Experimental Bun tests (branch trial)"}),"\n"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Goal: switch to Bun runtime for tests while keeping Vitest features."}),"\n",(0,t.jsxs)(n.li,{children:["Validate in a branch:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["jsdom compatibility with ",(0,t.jsx)(n.code,{children:"@testing-library/react"})," and\n",(0,t.jsx)(n.code,{children:"@testing-library/jest-dom"})," matchers."]}),"\n",(0,t.jsx)(n.li,{children:"Coverage parity (V8) and CI reporters (junit, html, text\u2011summary)."}),"\n",(0,t.jsx)(n.li,{children:"Threads isolation and max worker caps similar to current config."}),"\n",(0,t.jsxs)(n.li,{children:["Module aliasing (",(0,t.jsx)(n.code,{children:"#schema"}),", ",(0,t.jsx)(n.code,{children:"#enrich"}),", \u2026) continue to resolve."]}),"\n",(0,t.jsx)(n.li,{children:"Native addons build reliably across CI matrix."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"If parity is not achievable, keep Node for tests and use Bun elsewhere."}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"best-practices-checklist-for-a-bunfirst-repo",children:"Best practices checklist for a Bun\u2011first repo"}),"\n",(0,t.jsx)(n.p,{children:"Packaging & TS"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Keep ESM\u2011only package with explicit exports and types."}),"\n",(0,t.jsxs)(n.li,{children:["In ",(0,t.jsx)(n.code,{children:"tsconfig.base.json"}),": enable ",(0,t.jsx)(n.code,{children:"verbatimModuleSyntax"}),", ",(0,t.jsx)(n.code,{children:"declarationMap"}),",\n",(0,t.jsx)(n.code,{children:"preserveShebang"})," (see config review doc)."]}),"\n",(0,t.jsxs)(n.li,{children:["Set ",(0,t.jsx)(n.code,{children:"type"})," to ",(0,t.jsx)(n.code,{children:"module"})," (already) and ensure all binaries invoked via explicit\n",(0,t.jsx)(n.code,{children:"node"})," or ",(0,t.jsx)(n.code,{children:"bun"})," shims as needed."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Scripts & Tooling"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Respect the project rule to use pnpm for dependency management."}),"\n",(0,t.jsxs)(n.li,{children:["If using Bun CLIs locally, prefer ",(0,t.jsx)(n.code,{children:"bunx <tool>"})," for ad\u2011hoc execution but keep\n",(0,t.jsx)(n.code,{children:"pnpm"})," scripts as the source of truth in ",(0,t.jsx)(n.code,{children:"package.json"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["For tests, keep ",(0,t.jsx)(n.code,{children:"pnpm vitest"})," as canonical. Add an experimental ",(0,t.jsx)(n.code,{children:"test:bun"}),"\nscript in a branch only after validation."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Testing"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["If staying with Vitest: keep ",(0,t.jsx)(n.code,{children:"environment: 'jsdom'"}),", thread pool, and coverage\nthresholds; consider ",(0,t.jsx)(n.code,{children:"coverage.all: true"})," and per\u2011file targets."]}),"\n",(0,t.jsxs)(n.li,{children:["If trialing Bun tests: recreate a minimal subset of suites and ensure matcher\nparity (jest\u2011dom), async utilities (",(0,t.jsx)(n.code,{children:"screen.findBy*"}),"), and mock APIs are\nfeature\u2011complete for your cases."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Native addons (sharp, better\u2011sqlite3)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Ensure CI image has build toolchain: Python, C/C++ toolchain, ",(0,t.jsx)(n.code,{children:"pkg\u2011config"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Install system deps (e.g. libvips for sharp) before bun/npm install."}),"\n",(0,t.jsx)(n.li,{children:"Consider pinning versions known to build on Bun, or switch to pure JS\nalternatives if feasible for test environments."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Firecrawl"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"SDK usage under Bun is fine for runtime fetches."}),"\n",(0,t.jsxs)(n.li,{children:["MCP server remains Node\u2011launched with ",(0,t.jsx)(n.code,{children:"npx firecrawl-mcp"}),"; no need to change\nthat when adopting Bun elsewhere."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"CI"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Keep Node 22 job as primary for tests."}),"\n",(0,t.jsx)(n.li,{children:"Optionally add a Bun job that runs a smoke subset (CLI run, a few unit tests)\nto surface compatibility regressions early."}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"suggested-scripts-nonbreaking",children:"Suggested scripts (non\u2011breaking)"}),"\n",(0,t.jsx)(n.p,{children:"Keep existing scripts; optionally add these for experimentation:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsonc",children:'{\n  "scripts": {\n    "dev:bun": "bun run dist/cli.js",\n    "smoke:bun": "bun run ./dist/cli.js --help",\n    "test:bun:exp": "bunx vitest run", // experimental; validate before CI\n  },\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Note: ",(0,t.jsx)(n.code,{children:"bunx vitest"})," is experimental in this context. Prefer the standard\n",(0,t.jsx)(n.code,{children:"pnpm vitest"})," for CI until feature parity is proven."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"migration-plan-if-you-decide-to-adopt-bun-more-deeply",children:"Migration plan (if you decide to adopt Bun more deeply)"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Create a branch ",(0,t.jsx)(n.code,{children:"feat/bun-experiment"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Add the optional scripts above; do not alter CI yet."}),"\n",(0,t.jsxs)(n.li,{children:["Run a native addon build check on CI with Bun (Ubuntu/macOS):","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"sharp compiles and runs a tiny resize test."}),"\n",(0,t.jsx)(n.li,{children:"better\u2011sqlite3 opens a DB and performs a simple query."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Attempt ",(0,t.jsx)(n.code,{children:"bunx vitest run"})," on a subset of tests; compare coverage and timing\nvs Node."]}),"\n",(0,t.jsx)(n.li,{children:"If parity holds, introduce a parallel CI job for Bun tests."}),"\n",(0,t.jsx)(n.li,{children:"After 2\u20133 green cycles, consider switching default test job to Bun or keep\nboth (Node as primary, Bun as canary)."}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"decision-guidance",children:"Decision guidance"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"If you value the existing Vitest integrations (coverage, junit, rich mocks,\njsdom), staying on Node for tests is the lowest risk with the highest\ndeterminism."}),"\n",(0,t.jsx)(n.li,{children:"Use Bun where it\u2019s unambiguously beneficial (script execution, CLI dev speed)\nwithout changing the package manager or CI test substrate."}),"\n",(0,t.jsx)(n.li,{children:"Revisit \u201cBun for tests\u201d after native addon story and coverage/reporting parity\nmeet your needs in practice."}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"what-stays-the-same",children:"What stays the same"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"pnpm remains the package manager of record."}),"\n",(0,t.jsx)(n.li,{children:"Changesets continues to version and publish."}),"\n",(0,t.jsx)(n.li,{children:"ESLint flat config and Prettier rules unchanged; you can invoke them through\npnpm or bunx locally."}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"action-items",children:"Action items"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Decide on hybrid vs full Bun goals."]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","If hybrid, add optional local scripts and a small Bun smoke job in CI."]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","If full, create the experiment branch and validate parity items."]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Keep Firecrawl MCP server on Node; no change needed."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},5705:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>d});var i=s(7701);const t={},r=i.createContext(t);function l(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);