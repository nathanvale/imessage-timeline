"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[1659],{5705:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>t});var i=s(7701);const r={},l=i.createContext(r);function d(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),i.createElement(l.Provider,{value:n},e.children)}},6615:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"dual-mode-distribution-best-practices","title":"Dual-Mode Distribution Best Practices","description":"Overview","source":"@site/docs/dual-mode-distribution-best-practices.md","sourceDirName":".","slug":"/dual-mode-distribution-best-practices","permalink":"/imessage-timeline/docs/dual-mode-distribution-best-practices","draft":false,"unlisted":false,"editUrl":"https://github.com/nathanvale/imessage-timeline/tree/main/website/docs/dual-mode-distribution-best-practices.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Pre-Mode Workflow (Simple Visual)","permalink":"/imessage-timeline/docs/diagrams/pre-mode-workflow-simple"},"next":{"title":"Emergency Rollback Procedure","permalink":"/imessage-timeline/docs/emergency-rollback-procedure"}}');var r=s(6801),l=s(5705);const d={},t="Dual-Mode Distribution Best Practices",o={},c=[{value:"Overview",id:"overview",level:2},{value:"Research Foundation",id:"research-foundation",level:2},{value:"Package Architecture",id:"package-architecture",level:2},{value:"Dual Entry Points Strategy",id:"dual-entry-points-strategy",level:3},{value:"Current Configuration Analysis",id:"current-configuration-analysis",level:3},{value:"Best Practices from Research",id:"best-practices-from-research",level:2},{value:"1. Module Type Declaration",id:"1-module-type-declaration",level:3},{value:"2. Exports Field (Modern Standard)",id:"2-exports-field-modern-standard",level:3},{value:"Benefits",id:"benefits",level:4},{value:"Pattern: Main Entry Point",id:"pattern-main-entry-point",level:4},{value:"Pattern: Exposing package.json",id:"pattern-exposing-packagejson",level:4},{value:"Pattern: Subpath Exports (Optional)",id:"pattern-subpath-exports-optional",level:4},{value:"Pattern: Wildcard Subpath Exports (Advanced)",id:"pattern-wildcard-subpath-exports-advanced",level:4},{value:"3. Main Field (Backward Compatibility)",id:"3-main-field-backward-compatibility",level:3},{value:"4. Types Field",id:"4-types-field",level:3},{value:"5. Bin Field (CLI Support)",id:"5-bin-field-cli-support",level:3},{value:"6. Files Field (Distribution Control)",id:"6-files-field-distribution-control",level:3},{value:"Conditional Exports Deep Dive",id:"conditional-exports-deep-dive",level:2},{value:"Condition Order (Critical)",id:"condition-order-critical",level:3},{value:"Common Condition Use Cases",id:"common-condition-use-cases",level:3},{value:"Import vs Require (Dual Module Support)",id:"import-vs-require-dual-module-support",level:4},{value:"Node.js vs Browser",id:"nodejs-vs-browser",level:4},{value:"Development vs Production",id:"development-vs-production",level:4},{value:"Subpath Imports (Internal Package Aliases)",id:"subpath-imports-internal-package-aliases",level:2},{value:"Current Configuration",id:"current-configuration",level:3},{value:"Self-Referencing (Package Name Imports)",id:"self-referencing-package-name-imports",level:2},{value:"Feature: Importing from Own Package",id:"feature-importing-from-own-package",level:3},{value:"TypeScript Configuration for Dual Distribution",id:"typescript-configuration-for-dual-distribution",level:2},{value:"tsconfig.json Settings",id:"tsconfigjson-settings",level:3},{value:"Source File Extensions",id:"source-file-extensions",level:3},{value:"API Design Best Practices for Dual Distribution",id:"api-design-best-practices-for-dual-distribution",level:2},{value:"1. Clear Entry Point (src/index.ts)",id:"1-clear-entry-point-srcindexts",level:3},{value:"2. Separate CLI and Library Code",id:"2-separate-cli-and-library-code",level:3},{value:"3. Avoid CLI-Only Code in Library Exports",id:"3-avoid-cli-only-code-in-library-exports",level:3},{value:"Testing Dual Distribution",id:"testing-dual-distribution",level:2},{value:"1. Test CLI Usage",id:"1-test-cli-usage",level:3},{value:"2. Test Library Import",id:"2-test-library-import",level:3},{value:"3. Test Package.json Exports",id:"3-test-packagejson-exports",level:3},{value:"Publishing Checklist",id:"publishing-checklist",level:2},{value:"Pre-Publish Validation",id:"pre-publish-validation",level:3},{value:"Package.json Final Check",id:"packagejson-final-check",level:3},{value:"Common Pitfalls and Solutions",id:"common-pitfalls-and-solutions",level:2},{value:"Issue 1: CLI Not Executable After Install",id:"issue-1-cli-not-executable-after-install",level:3},{value:"Issue 2: Cannot Find Module When Importing",id:"issue-2-cannot-find-module-when-importing",level:3},{value:"Issue 3: TypeScript Types Not Found",id:"issue-3-typescript-types-not-found",level:3},{value:"Issue 4: Internal Paths Exposed",id:"issue-4-internal-paths-exposed",level:3},{value:"Advanced Patterns (Future Considerations)",id:"advanced-patterns-future-considerations",level:2},{value:"1. Subpath Exports for Large Packages",id:"1-subpath-exports-for-large-packages",level:3},{value:"2. Conditional Exports for Minified Builds",id:"2-conditional-exports-for-minified-builds",level:3},{value:"3. Dual ESM/CJS Distribution",id:"3-dual-esmcjs-distribution",level:3},{value:"Summary",id:"summary",level:2},{value:"Current Status: \u2705 Excellent",id:"current-status--excellent",level:3},{value:"No Breaking Changes Needed",id:"no-breaking-changes-needed",level:3},{value:"Recommendations for src/index.ts",id:"recommendations-for-srcindexts",level:3},{value:"Next Steps",id:"next-steps",level:3},{value:"Appendix: Research Sources",id:"appendix-research-sources",level:2},{value:"TypeScript Documentation",id:"typescript-documentation",level:3},{value:"Node.js Documentation",id:"nodejs-documentation",level:3},{value:"Community Standards",id:"community-standards",level:3},{value:"Appendix: Quick Reference Card",id:"appendix-quick-reference-card",level:2},{value:"Minimal Dual-Mode Package",id:"minimal-dual-mode-package",level:3},{value:"CLI Entry Point Template",id:"cli-entry-point-template",level:3},{value:"Library Entry Point Template",id:"library-entry-point-template",level:3}];function a(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"dual-mode-distribution-best-practices",children:"Dual-Mode Distribution Best Practices"})}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.p,{children:["This document provides comprehensive guidance on distributing\n",(0,r.jsx)(n.strong,{children:"imessage-timeline"})," as both a ",(0,r.jsx)(n.strong,{children:"CLI tool"})," and a ",(0,r.jsx)(n.strong,{children:"library package"}),". It\nsynthesizes research from official TypeScript and Node.js documentation to\nensure best practices for dual-mode packages."]}),"\n",(0,r.jsx)(n.h2,{id:"research-foundation",children:"Research Foundation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"TypeScript Documentation"}),": Explored 60+ package.json configuration examples\nfrom TypeScript's test baselines, covering conditional exports, ESM/CJS dual\ndistributions, and types resolution"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Node.js Official Packages API"}),": Complete Node.js v25.1.0 package.json\nspecification including exports, bin, main, and conditional exports patterns"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Key Findings"}),": Modern Node.js (v12+) with ",(0,r.jsx)(n.code,{children:"exports"})," field provides superior\nencapsulation and subpath control compared to legacy ",(0,r.jsx)(n.code,{children:"main"}),"-only\nconfigurations"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"package-architecture",children:"Package Architecture"}),"\n",(0,r.jsx)(n.h3,{id:"dual-entry-points-strategy",children:"Dual Entry Points Strategy"}),"\n",(0,r.jsxs)(n.p,{children:["The package provides ",(0,r.jsx)(n.strong,{children:"two distinct entry points"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"CLI Entry Point"}),": Executable binary for command-line usage"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Field"}),": ",(0,r.jsx)(n.code,{children:"bin"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Target"}),": ",(0,r.jsx)(n.code,{children:"./dist/cli.js"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Usage"}),": ",(0,r.jsx)(n.code,{children:"npx imessage-timeline"})," or ",(0,r.jsx)(n.code,{children:"imessage-timeline"})," (when installed\nglobally)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Library Entry Point"}),": Module exports for programmatic usage"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Fields"}),": ",(0,r.jsx)(n.code,{children:"main"}),", ",(0,r.jsx)(n.code,{children:"exports"}),", ",(0,r.jsx)(n.code,{children:"types"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Target"}),": ",(0,r.jsx)(n.code,{children:"./dist/index.js"})," (runtime), ",(0,r.jsx)(n.code,{children:"./dist/index.d.ts"})," (types)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Usage"}),": ",(0,r.jsx)(n.code,{children:"import { loadConfig } from 'imessage-timeline'"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"current-configuration-analysis",children:"Current Configuration Analysis"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "bin": {\n    "imessage-timeline": "./dist/cli.js"\n  },\n  "exports": {\n    ".": {\n      "import": "./dist/index.js",\n      "types": "./dist/index.d.ts"\n    },\n    "./package.json": "./package.json"\n  },\n  "main": "./dist/index.js",\n  "name": "imessage-timeline",\n  "type": "module",\n  "types": "./dist/index.d.ts"\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Status"}),": \u2705 ",(0,r.jsx)(n.strong,{children:"Already optimal"})," for dual-mode distribution"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"best-practices-from-research",children:"Best Practices from Research"}),"\n",(0,r.jsx)(n.h3,{id:"1-module-type-declaration",children:"1. Module Type Declaration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "type": "module"\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Why"}),": Declares all ",(0,r.jsx)(n.code,{children:".js"})," files as ES modules. This is ",(0,r.jsx)(n.strong,{children:"essential"})," for\nNode.js v12+ to correctly interpret imports and prevent CommonJS/ESM conflicts."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Alternatives"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:".mjs"})," extensions force ESM (regardless of ",(0,r.jsx)(n.code,{children:"type"})," field)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:".cjs"})," extensions force CommonJS (regardless of ",(0,r.jsx)(n.code,{children:"type"})," field)"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Our Choice"}),": Use ",(0,r.jsx)(n.code,{children:'"type": "module"'})," with ",(0,r.jsx)(n.code,{children:".js"})," extensions for simplicity and\nconsistency."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"2-exports-field-modern-standard",children:"2. Exports Field (Modern Standard)"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"exports"})," field is the ",(0,r.jsx)(n.strong,{children:"recommended approach"})," for defining package entry\npoints in Node.js v12+."]}),"\n",(0,r.jsx)(n.h4,{id:"benefits",children:"Benefits"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Encapsulation"}),": Prevents importing internal modules (e.g.,\n",(0,r.jsx)(n.code,{children:"require('pkg/internal/utils')"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Conditional Exports"}),": Different entry points for ",(0,r.jsx)(n.code,{children:"import"})," vs ",(0,r.jsx)(n.code,{children:"require"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Subpath Patterns"}),": Control which subpaths are accessible"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Types Integration"}),": Direct TypeScript declaration file mapping"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"pattern-main-entry-point",children:"Pattern: Main Entry Point"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "exports": {\n    ".": {\n      "import": "./dist/index.js",\n      "types": "./dist/index.d.ts"\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Research Insight"}),": The ",(0,r.jsx)(n.code,{children:'"types"'})," condition should ",(0,r.jsx)(n.strong,{children:"always be first"})," in the\ncondition object (per TypeScript community conventions and Runtime Keys\nproposal)."]}),"\n",(0,r.jsx)(n.h4,{id:"pattern-exposing-packagejson",children:"Pattern: Exposing package.json"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "exports": {\n    ".": "./dist/index.js",\n    "./package.json": "./package.json"\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Why"}),": Allows consumers to read package metadata (e.g., for version checks)\nwithout breaking encapsulation."]}),"\n",(0,r.jsx)(n.h4,{id:"pattern-subpath-exports-optional",children:"Pattern: Subpath Exports (Optional)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "exports": {\n    ".": "./dist/index.js",\n    "./config": "./dist/config/index.js",\n    "./utils": "./dist/utils/index.js"\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"When to Use"}),": For large packages where exposing organized subpaths improves\ntree-shaking and reduces bundle size. Not necessary for small/medium packages."]}),"\n",(0,r.jsx)(n.h4,{id:"pattern-wildcard-subpath-exports-advanced",children:"Pattern: Wildcard Subpath Exports (Advanced)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "exports": {\n    ".": "./dist/index.js",\n    "./config/*": "./dist/config/*.js",\n    "./utils/*": "./dist/utils/*.js"\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"When to Use"}),": For packages with many submodules. Allows\n",(0,r.jsx)(n.code,{children:"import { x } from 'pkg/config/loader.js'"})," without enumerating every file."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Trade-offs"}),": Less explicit API surface, harder to track breaking changes."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"3-main-field-backward-compatibility",children:"3. Main Field (Backward Compatibility)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "main": "./dist/index.js"\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Why"}),": Provides fallback for Node.js v10 and older tools that don't support\n",(0,r.jsx)(n.code,{children:"exports"})," field."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Behavior"}),": When both ",(0,r.jsx)(n.code,{children:"main"})," and ",(0,r.jsx)(n.code,{children:"exports"})," are present, modern Node.js\n",(0,r.jsxs)(n.strong,{children:["prefers ",(0,r.jsx)(n.code,{children:"exports"})]}),", but older environments fall back to ",(0,r.jsx)(n.code,{children:"main"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Best Practice"}),": Always include both ",(0,r.jsx)(n.code,{children:"main"})," and ",(0,r.jsx)(n.code,{children:"exports"})," pointing to the same\nentry file for maximum compatibility."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"4-types-field",children:"4. Types Field"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "types": "./dist/index.d.ts"\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Why"}),": Defines the TypeScript declaration entry point for the package."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsxs)(n.strong,{children:["Relationship with ",(0,r.jsx)(n.code,{children:"exports"})]}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["If ",(0,r.jsx)(n.code,{children:"exports"})," includes a ",(0,r.jsx)(n.code,{children:'"types"'})," condition, it takes precedence"]}),"\n",(0,r.jsxs)(n.li,{children:["If ",(0,r.jsx)(n.code,{children:"exports"})," doesn't specify ",(0,r.jsx)(n.code,{children:'"types"'}),", TypeScript falls back to the top-level\n",(0,r.jsx)(n.code,{children:'"types"'})," field"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Best Practice"}),": Include both:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Top-level ",(0,r.jsx)(n.code,{children:'"types"'})," for legacy TypeScript versions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'"types"'})," condition in ",(0,r.jsx)(n.code,{children:"exports"})," for modern resolution"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"5-bin-field-cli-support",children:"5. Bin Field (CLI Support)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "bin": {\n    "imessage-timeline": "./dist/cli.js"\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Requirements"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Executable Shebang"}),": First line of ",(0,r.jsx)(n.code,{children:"dist/cli.js"})," must be\n",(0,r.jsx)(n.code,{children:"#!/usr/bin/env node"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"File Permissions"}),": Must be executable (",(0,r.jsx)(n.code,{children:"chmod +x dist/cli.js"}),") or npm will\nhandle this automatically during install"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Separate from Library"}),": CLI entry point should be distinct from library\nentry point"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Multiple Binaries"})," (if needed):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "bin": {\n    "imessage-timeline": "./dist/cli.js",\n    "imt": "./dist/cli.js"\n  }\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"6-files-field-distribution-control",children:"6. Files Field (Distribution Control)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "files": ["dist/**", "README.md", "LICENSE", "CHANGELOG.md"]\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Why"}),": Controls which files are included when publishing to npm. Keeps package\nsize minimal."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note"}),": ",(0,r.jsx)(n.code,{children:"package.json"})," is ",(0,r.jsx)(n.strong,{children:"always included"})," automatically."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"conditional-exports-deep-dive",children:"Conditional Exports Deep Dive"}),"\n",(0,r.jsx)(n.h3,{id:"condition-order-critical",children:"Condition Order (Critical)"}),"\n",(0,r.jsxs)(n.p,{children:["Conditions are matched ",(0,r.jsx)(n.strong,{children:"top-to-bottom"}),", so order matters:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "exports": {\n    ".": {\n      "default": "./dist/index.js", // 5. Fallback\n      "import": "./dist/index.mjs", // 3. ESM import\n      "node": "./dist/index.node.js", // 2. Node.js-specific\n      "require": "./dist/index.cjs", // 4. CommonJS require\n      "types": "./dist/index.d.ts" // 1. Types (TypeScript)\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Best Practice Order"})," (from TypeScript and Runtime Keys proposal):"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'"types"'})," \u2014 TypeScript declaration files"]}),"\n",(0,r.jsxs)(n.li,{children:["Platform-specific (",(0,r.jsx)(n.code,{children:'"node"'}),", ",(0,r.jsx)(n.code,{children:'"browser"'}),", ",(0,r.jsx)(n.code,{children:'"deno"'}),", etc.)"]}),"\n",(0,r.jsxs)(n.li,{children:["Module format (",(0,r.jsx)(n.code,{children:'"import"'}),", ",(0,r.jsx)(n.code,{children:'"require"'}),", ",(0,r.jsx)(n.code,{children:'"module-sync"'}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'"default"'})," \u2014 Always last, as universal fallback"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"common-condition-use-cases",children:"Common Condition Use Cases"}),"\n",(0,r.jsx)(n.h4,{id:"import-vs-require-dual-module-support",children:"Import vs Require (Dual Module Support)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "exports": {\n    ".": {\n      "import": "./dist/index.mjs",\n      "require": "./dist/index.cjs"\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"When to Use"}),": When supporting both ESM (",(0,r.jsx)(n.code,{children:"import"}),") and CommonJS (",(0,r.jsx)(n.code,{children:"require"}),")\nconsumers."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Our Case"}),": Not needed \u2014 we only distribute ESM (via ",(0,r.jsx)(n.code,{children:'"type": "module"'}),")."]}),"\n",(0,r.jsx)(n.h4,{id:"nodejs-vs-browser",children:"Node.js vs Browser"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "exports": {\n    ".": {\n      "browser": "./dist/index.browser.js",\n      "default": "./dist/index.js",\n      "node": "./dist/index.node.js"\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"When to Use"}),": When providing different implementations for server vs browser\nenvironments."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Our Case"}),": Not needed \u2014 CLI tool is Node.js-only."]}),"\n",(0,r.jsx)(n.h4,{id:"development-vs-production",children:"Development vs Production"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "exports": {\n    ".": {\n      "default": "./dist/index.js",\n      "development": "./dist/index.dev.js",\n      "production": "./dist/index.prod.js"\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"When to Use"}),": When providing debug-enabled builds for development."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Activation"}),": ",(0,r.jsx)(n.code,{children:"node --conditions=development index.js"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Our Case"}),": Not needed for MVP, but useful for future enhanced logging."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"subpath-imports-internal-package-aliases",children:"Subpath Imports (Internal Package Aliases)"}),"\n",(0,r.jsx)(n.h3,{id:"current-configuration",children:"Current Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "imports": {\n    "#enrich/*": "./src/enrich/*",\n    "#ingest/*": "./src/ingest/*",\n    "#normalize/*": "./src/normalize/*",\n    "#render/*": "./src/render/*",\n    "#schema/*": "./src/schema/*"\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose"}),": Creates internal aliases for use ",(0,r.jsx)(n.strong,{children:"within the package itself"}),", not\nexposed to consumers."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Requirements"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["All imports must start with ",(0,r.jsx)(n.code,{children:"#"})]}),"\n",(0,r.jsxs)(n.li,{children:["Used in source files: ",(0,r.jsx)(n.code,{children:"import { Message } from '#schema/message.js'"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Benefits"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Shorter import paths within the codebase"}),"\n",(0,r.jsx)(n.li,{children:"Easy refactoring (change mapping in one place)"}),"\n",(0,r.jsx)(n.li,{children:"No impact on consumers (not exported)"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note"}),": These are ",(0,r.jsx)(n.strong,{children:"not"})," accessible to library consumers \u2014 they're\ninternal-only."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"self-referencing-package-name-imports",children:"Self-Referencing (Package Name Imports)"}),"\n",(0,r.jsx)(n.h3,{id:"feature-importing-from-own-package",children:"Feature: Importing from Own Package"}),"\n",(0,r.jsxs)(n.p,{children:["When ",(0,r.jsx)(n.code,{children:"exports"})," is defined, modules ",(0,r.jsx)(n.strong,{children:"inside the package"})," can import using the\npackage name:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Inside src/some-module.ts\nimport { loadConfig } from 'imessage-timeline'\n"})}),"\n",(0,r.jsx)(n.p,{children:"Instead of relative imports:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { loadConfig } from '../config/loader.js'\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Requirements"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Must have ",(0,r.jsx)(n.code,{children:'"name"'})," field in package.json"]}),"\n",(0,r.jsxs)(n.li,{children:["Must have ",(0,r.jsx)(n.code,{children:'"exports"'})," field defined"]}),"\n",(0,r.jsxs)(n.li,{children:["Only works for paths explicitly listed in ",(0,r.jsx)(n.code,{children:"exports"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"When to Use"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Testing internal APIs from the consumer's perspective"}),"\n",(0,r.jsx)(n.li,{children:"Ensuring consistency between internal and external imports"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Our Case"}),": Useful for tests, but relative imports are fine for source code."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"typescript-configuration-for-dual-distribution",children:"TypeScript Configuration for Dual Distribution"}),"\n",(0,r.jsx)(n.h3,{id:"tsconfigjson-settings",children:"tsconfig.json Settings"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "compilerOptions": {\n    "declaration": true,\n    "declarationMap": true,\n    "module": "NodeNext",\n    "moduleResolution": "NodeNext",\n    "outDir": "./dist",\n    "rootDir": "./src"\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Key Settings"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:'module: "NodeNext"'})}),": Matches Node.js ES module resolution"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:'moduleResolution: "NodeNext"'})}),": Enables ",(0,r.jsx)(n.code,{children:"exports"})," field support"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"declaration: true"})}),": Generates ",(0,r.jsx)(n.code,{children:".d.ts"})," files"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"declarationMap: true"})}),': Enables "Go to Definition" in consumers\' editors']}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"source-file-extensions",children:"Source File Extensions"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Current"}),": ",(0,r.jsx)(n.code,{children:".ts"})," files (source) \u2192 ",(0,r.jsx)(n.code,{children:".js"})," files (compiled)"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Recommendations"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Keep ",(0,r.jsx)(n.code,{children:".ts"})," for source files (simplicity)"]}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:".js"})," extensions in imports: ",(0,r.jsx)(n.code,{children:"import './foo.js'"})," (not ",(0,r.jsx)(n.code,{children:"'./foo'"}),")"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Why"}),": TypeScript requires explicit extensions in ESM mode when using\n",(0,r.jsx)(n.code,{children:"moduleResolution: NodeNext"}),"."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"api-design-best-practices-for-dual-distribution",children:"API Design Best Practices for Dual Distribution"}),"\n",(0,r.jsx)(n.h3,{id:"1-clear-entry-point-srcindexts",children:"1. Clear Entry Point (src/index.ts)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"/**\n * Public API for imessage-timeline library\n *\n * This package can be used both as:\n * 1. CLI tool: `npx imessage-timeline --help`\n * 2. Library: `import { loadConfig } from 'imessage-timeline'`\n */\n\n// Export only public APIs\nexport { loadConfig, generateConfigContent } from './config/index.js'\nexport type { Config } from './config/schema.js'\n\n// Do NOT export internal utilities unless needed\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Guidelines"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Document dual-use nature at the top"}),"\n",(0,r.jsx)(n.li,{children:"Export only stable public APIs"}),"\n",(0,r.jsx)(n.li,{children:"Use JSDoc comments for each export"}),"\n",(0,r.jsx)(n.li,{children:"Group exports by feature/module"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-separate-cli-and-library-code",children:"2. Separate CLI and Library Code"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Pattern"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"src/\n  cli.ts          \u2190 CLI entry point (Commander, arg parsing)\n  index.ts        \u2190 Library entry point (public API exports)\n  config/         \u2190 Shared logic (used by both CLI and library)\n  utils/          \u2190 Shared utilities\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Benefits"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"CLI-specific dependencies (e.g., Commander) don't pollute library consumers"}),"\n",(0,r.jsx)(n.li,{children:"Clear separation of concerns"}),"\n",(0,r.jsx)(n.li,{children:"Easier to maintain and test independently"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-avoid-cli-only-code-in-library-exports",children:"3. Avoid CLI-Only Code in Library Exports"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Bad"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// src/index.ts (BAD)\nexport { parseCliArgs } from './cli.js' // \u274c CLI-specific\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Good"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// src/index.ts (GOOD)\nexport { loadConfig } from './config/loader.js' // \u2705 Useful in library\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Reason"}),": Library consumers don't need CLI argument parsing logic."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"testing-dual-distribution",children:"Testing Dual Distribution"}),"\n",(0,r.jsx)(n.h3,{id:"1-test-cli-usage",children:"1. Test CLI Usage"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Local development\nbun src/cli.ts --help\n\n# After build\nnode dist/cli.js --help\n\n# As installed package\nnpx imessage-timeline --help\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-test-library-import",children:"2. Test Library Import"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// test-library-import.ts\nimport { loadConfig } from 'imessage-timeline'\n\nconst config = loadConfig('path/to/config.yaml')\nconsole.log('Config loaded:', config)\n"})}),"\n",(0,r.jsx)(n.p,{children:"Run:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"bun test-library-import.ts\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-test-packagejson-exports",children:"3. Test Package.json Exports"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Ensure only exported paths work\nnode -e \"import('imessage-timeline').then(console.log)\"           # \u2705 Should work\nnode -e \"import('imessage-timeline/config').then(console.log)\"    # \u274c Should fail (not exported)\nnode -e \"import('imessage-timeline/package.json').then(console.log)\" # \u2705 Should work (explicitly exported)\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"publishing-checklist",children:"Publishing Checklist"}),"\n",(0,r.jsx)(n.h3,{id:"pre-publish-validation",children:"Pre-Publish Validation"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Build Check"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"bun run build\nls -lh dist/  # Verify cli.js and index.js exist\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Shebang Check"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"head -n 1 dist/cli.js  # Should be #!/usr/bin/env node\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"TypeScript Types Check"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ls -lh dist/*.d.ts  # Verify .d.ts files generated\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Files Check"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm pack --dry-run  # Preview what will be published\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Exports Validation"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"node --input-type=module -e \"import('imessage-timeline').then(m => console.log(Object.keys(m)))\"\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"packagejson-final-check",children:"Package.json Final Check"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "bin": { "imessage-timeline": "./dist/cli.js" },\n  "engines": { "node": ">=22.20" },\n  "exports": {\n    ".": {\n      "import": "./dist/index.js",\n      "types": "./dist/index.d.ts"\n    },\n    "./package.json": "./package.json"\n  },\n\n  "files": ["dist/**", "README.md", "LICENSE"],\n  "main": "./dist/index.js",\n  "name": "imessage-timeline",\n  "type": "module",\n\n  "types": "./dist/index.d.ts",\n\n  "version": "1.0.0"\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"common-pitfalls-and-solutions",children:"Common Pitfalls and Solutions"}),"\n",(0,r.jsx)(n.h3,{id:"issue-1-cli-not-executable-after-install",children:"Issue 1: CLI Not Executable After Install"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": ",(0,r.jsx)(n.code,{children:"command not found: imessage-timeline"})," after ",(0,r.jsx)(n.code,{children:"npm install -g"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Verify ",(0,r.jsx)(n.code,{children:"bin"})," field points to correct file"]}),"\n",(0,r.jsxs)(n.li,{children:["Ensure ",(0,r.jsx)(n.code,{children:"#!/usr/bin/env node"})," is first line of CLI file"]}),"\n",(0,r.jsxs)(n.li,{children:["Check file permissions: ",(0,r.jsx)(n.code,{children:"ls -l dist/cli.js"})," (should show ",(0,r.jsx)(n.code,{children:"x"})," flag)"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"issue-2-cannot-find-module-when-importing",children:"Issue 2: Cannot Find Module When Importing"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": ",(0,r.jsx)(n.code,{children:"ERR_MODULE_NOT_FOUND"})," when importing from library"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Verify ",(0,r.jsx)(n.code,{children:"exports"})," field includes ",(0,r.jsx)(n.code,{children:'".": "./dist/index.js"'})]}),"\n",(0,r.jsxs)(n.li,{children:["Check TypeScript compiled files to ",(0,r.jsx)(n.code,{children:"dist/"})]}),"\n",(0,r.jsxs)(n.li,{children:["Ensure ",(0,r.jsx)(n.code,{children:'"type": "module"'})," is set"]}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:".js"})," extensions in import paths (even in TypeScript)"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"issue-3-typescript-types-not-found",children:"Issue 3: TypeScript Types Not Found"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": ",(0,r.jsx)(n.code,{children:"Could not find a declaration file for module 'imessage-timeline'"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Verify ",(0,r.jsx)(n.code,{children:'"types": "./dist/index.d.ts"'})," in package.json"]}),"\n",(0,r.jsxs)(n.li,{children:["Add ",(0,r.jsx)(n.code,{children:'"types"'})," condition to ",(0,r.jsx)(n.code,{children:"exports"})," field"]}),"\n",(0,r.jsxs)(n.li,{children:["Check ",(0,r.jsx)(n.code,{children:"dist/"})," contains ",(0,r.jsx)(n.code,{children:".d.ts"})," files"]}),"\n",(0,r.jsxs)(n.li,{children:["Ensure ",(0,r.jsx)(n.code,{children:"tsconfig.json"})," has ",(0,r.jsx)(n.code,{children:'"declaration": true'})]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"issue-4-internal-paths-exposed",children:"Issue 4: Internal Paths Exposed"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom"}),": Consumers can import ",(0,r.jsx)(n.code,{children:"require('pkg/internal/secret.js')"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"exports"})," field to restrict paths"]}),"\n",(0,r.jsxs)(n.li,{children:["Do NOT include ",(0,r.jsx)(n.code,{children:'"./internal/*"'})," in exports"]}),"\n",(0,r.jsxs)(n.li,{children:["Test with: ",(0,r.jsx)(n.code,{children:"node -e \"import('imessage-timeline/internal/file.js')\""}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Should throw ",(0,r.jsx)(n.code,{children:"ERR_PACKAGE_PATH_NOT_EXPORTED"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"advanced-patterns-future-considerations",children:"Advanced Patterns (Future Considerations)"}),"\n",(0,r.jsx)(n.h3,{id:"1-subpath-exports-for-large-packages",children:"1. Subpath Exports for Large Packages"}),"\n",(0,r.jsx)(n.p,{children:"If the package grows significantly, consider exposing organized subpaths:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "exports": {\n    ".": "./dist/index.js",\n    "./config": "./dist/config/index.js",\n    "./enrich": "./dist/enrich/index.js",\n    "./ingest": "./dist/ingest/index.js",\n    "./render": "./dist/render/index.js"\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Benefits"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Tree-shaking: Import only needed modules"}),"\n",(0,r.jsx)(n.li,{children:"Clear API boundaries"}),"\n",(0,r.jsx)(n.li,{children:"Easier versioning and deprecation"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Trade-offs"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"More maintenance (must update for each new subpath)"}),"\n",(0,r.jsx)(n.li,{children:"Potential breaking changes if internal structure changes"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"2-conditional-exports-for-minified-builds",children:"2. Conditional Exports for Minified Builds"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "exports": {\n    ".": {\n      "default": "./dist/index.js",\n      "development": "./dist/index.js",\n      "production": "./dist/index.min.js"\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Activation"}),": ",(0,r.jsx)(n.code,{children:"node --conditions=production index.js"})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"3-dual-esmcjs-distribution",children:"3. Dual ESM/CJS Distribution"}),"\n",(0,r.jsx)(n.p,{children:"If CommonJS support becomes necessary:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "exports": {\n    ".": {\n      "import": "./dist/index.mjs",\n      "require": "./dist/index.cjs",\n      "types": "./dist/index.d.ts"\n    }\n  },\n  "type": "module"\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Requirements"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Compile to both ",(0,r.jsx)(n.code,{children:".mjs"})," (ESM) and ",(0,r.jsx)(n.code,{children:".cjs"})," (CommonJS)"]}),"\n",(0,r.jsx)(n.li,{children:"Handle dual package hazards (see Node.js documentation)"}),"\n",(0,r.jsx)(n.li,{children:"Significant complexity increase"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Recommendation"}),": Avoid unless there's strong demand for CJS support."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsx)(n.h3,{id:"current-status--excellent",children:"Current Status: \u2705 Excellent"}),"\n",(0,r.jsxs)(n.p,{children:["The package is ",(0,r.jsx)(n.strong,{children:"already configured optimally"})," for dual CLI + library\ndistribution:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u2705 Separate ",(0,r.jsx)(n.code,{children:"bin"})," and ",(0,r.jsx)(n.code,{children:"main"})," entry points"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 Modern ",(0,r.jsx)(n.code,{children:"exports"})," field with types integration"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 Backward-compatible ",(0,r.jsx)(n.code,{children:"main"})," fallback"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ESM-only distribution (",(0,r.jsx)(n.code,{children:'"type": "module"'}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 Internal package aliases via ",(0,r.jsx)(n.code,{children:"imports"})]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 Proper ",(0,r.jsx)(n.code,{children:"files"})," field for distribution control"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"no-breaking-changes-needed",children:"No Breaking Changes Needed"}),"\n",(0,r.jsx)(n.p,{children:"All current configurations align with best practices from TypeScript and Node.js\nofficial documentation."}),"\n",(0,r.jsx)(n.h3,{id:"recommendations-for-srcindexts",children:"Recommendations for src/index.ts"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Complete API Exports"}),": Ensure all intended public functions/types are\nexported"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Clear Documentation"}),": Add JSDoc comments for each major export"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Verify Import Paths"}),": Fix any import errors (e.g., missing ",(0,r.jsx)(n.code,{children:".js"}),"\nextensions)"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Fix import errors in ",(0,r.jsx)(n.code,{children:"src/index.ts"})," (detailed in next section)"]}),"\n",(0,r.jsx)(n.li,{children:"Update README with dual-mode usage examples"}),"\n",(0,r.jsx)(n.li,{children:"Test both CLI and library usage patterns"}),"\n",(0,r.jsx)(n.li,{children:"Publish to npm with confidence \ud83d\ude80"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"appendix-research-sources",children:"Appendix: Research Sources"}),"\n",(0,r.jsx)(n.h3,{id:"typescript-documentation",children:"TypeScript Documentation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Source"}),": microsoft/typescript repository test baselines"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Key Files"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"nodeModulesDeclarationEmitWithPackageExports"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"conditionalExportsResolution*"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"nodeModulesExports*"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Coverage"}),": 60+ conditional exports examples, ESM/CJS dual patterns, types\nresolution strategies"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"nodejs-documentation",children:"Node.js Documentation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Source"}),": Node.js v25.1.0 official Packages API documentation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"URL"}),": ",(0,r.jsx)(n.a,{href:"https://nodejs.org/api/packages.html",children:"https://nodejs.org/api/packages.html"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Key Sections"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Package entry points (main, exports, bin)"}),"\n",(0,r.jsx)(n.li,{children:"Conditional exports and community conditions"}),"\n",(0,r.jsx)(n.li,{children:"Subpath exports and subpath patterns"}),"\n",(0,r.jsx)(n.li,{children:"Module resolution algorithms (CommonJS vs ESM)"}),"\n",(0,r.jsx)(n.li,{children:"Self-referencing and package imports"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"community-standards",children:"Community Standards"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Runtime Keys Proposal"})," (WinterCG): Defines standard condition keys for\ncross-runtime compatibility"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"TypeScript Handbook"}),": Module resolution strategies for package authors"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"NPM Documentation"}),": Publishing best practices and package.json field\ndefinitions"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"appendix-quick-reference-card",children:"Appendix: Quick Reference Card"}),"\n",(0,r.jsx)(n.h3,{id:"minimal-dual-mode-package",children:"Minimal Dual-Mode Package"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "bin": { "my-cli": "./dist/cli.js" },\n  "exports": {\n    ".": {\n      "import": "./dist/index.js",\n      "types": "./dist/index.d.ts"\n    }\n  },\n  "files": ["dist"],\n  "main": "./dist/index.js",\n  "name": "my-package",\n  "type": "module",\n  "types": "./dist/index.d.ts",\n  "version": "1.0.0"\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"cli-entry-point-template",children:"CLI Entry Point Template"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"#!/usr/bin/env node\n\nimport { Command } from 'commander'\nimport { doSomething } from './library-code.js'\n\nconst program = new Command()\nprogram\n  .name('my-cli')\n  .description('CLI tool description')\n  .action(() => {\n    doSomething()\n  })\n\nprogram.parse()\n"})}),"\n",(0,r.jsx)(n.h3,{id:"library-entry-point-template",children:"Library Entry Point Template"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"/**\n * Public API for my-package\n *\n * Can be used as:\n * - CLI: npx my-package\n * - Library: import { doSomething } from 'my-package'\n */\n\nexport { doSomething } from './library-code.js'\nexport type { SomeType } from './types.js'\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Document Version"}),": 1.0",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.strong,{children:"Last Updated"}),": 2025-01-27",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.strong,{children:"Author"}),": GitHub Copilot + TypeScript/Node.js Official Documentation",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.strong,{children:"Review Status"}),": Ready for Implementation \u2705"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}}}]);